// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ========================================
// Restaurant Reservation System Models
// ========================================
// Note: All tables use 'restaurant_' prefix for multi-portfolio support
// tenantId is used for logical data separation

model RestaurantUser {
  id        String   @id @default(uuid())
  tenantId  String   @default("demo-restaurant") @map("tenant_id")
  authId    String?  @unique @map("auth_id") // Supabase Auth UUID
  email     String
  name      String?
  phone     String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  reservations RestaurantReservation[]

  @@unique([tenantId, email])
  @@index([tenantId])
  @@map("restaurant_users")
}

model RestaurantStaff {
  id        String   @id @default(uuid())
  tenantId  String   @default("demo-restaurant") @map("tenant_id")
  name      String
  role      String? // 役職（例: スタイリスト、シニアスタイリスト）
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  reservations RestaurantReservation[]

  @@index([tenantId])
  @@map("restaurant_staff")
}

model RestaurantMenu {
  id          String   @id @default(uuid())
  tenantId    String   @default("demo-restaurant") @map("tenant_id")
  name        String
  description String?
  price       Int // 価格（円）
  duration    Int // 所要時間（分）
  isActive    Boolean  @default(true) @map("is_active")
  category    String? // カテゴリ（例: カット、カラー、パーマ）
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  reservations RestaurantReservation[]

  @@index([tenantId])
  @@map("restaurant_menus")
}

model RestaurantReservation {
  id       String @id @default(uuid())
  tenantId String @default("demo-restaurant") @map("tenant_id")
  userId   String @map("user_id")
  staffId  String @map("staff_id")
  menuId   String @map("menu_id")

  reservedDate DateTime          @map("reserved_date") // 予約日
  reservedTime String            @map("reserved_time") // 予約時間（例: "14:00"）
  status       ReservationStatus @default(PENDING)

  notes     String? // 備考・要望
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  user  RestaurantUser  @relation(fields: [userId], references: [id], onDelete: Cascade)
  staff RestaurantStaff @relation(fields: [staffId], references: [id])
  menu  RestaurantMenu  @relation(fields: [menuId], references: [id])

  @@index([tenantId])
  @@index([userId])
  @@index([reservedDate])
  @@map("restaurant_reservations")
}

model RestaurantSettings {
  id         String  @id @default(uuid())
  tenantId   String  @unique @default("demo-restaurant") @map("tenant_id")
  storeName  String  @map("store_name")
  storeEmail String? @map("store_email")
  storePhone String? @map("store_phone")

  openTime   String   @default("09:00") @map("open_time")
  closeTime  String   @default("20:00") @map("close_time")
  closedDays String[] @default([]) @map("closed_days") // 定休日（例: ["Sunday", "Monday"]）

  slotDuration Int @default(30) @map("slot_duration") // 予約枠の間隔（分）

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("restaurant_settings")
}

// ========================================
// Enums
// ========================================

enum ReservationStatus {
  PENDING // 予約確定待ち
  CONFIRMED // 確定
  CANCELLED // キャンセル
  COMPLETED // 完了（来店済み）
  NO_SHOW // 無断キャンセル
}
