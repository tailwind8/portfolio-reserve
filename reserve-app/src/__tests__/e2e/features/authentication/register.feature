# language: ja

Feature: ユーザー新規登録
  新規ユーザーとしてアカウントを作成したい

  Issue: #5

  ユーザーストーリー:
  As a new customer
  I want to create an account
  So that I can make reservations and manage my bookings

  Background:
    Given ユーザーが新規登録ページにアクセスしている

  # 基本表示
  Scenario: 新規登録ページが正しく表示される
    Then ページタイトルに「予約システム」が表示される
    And ページ見出しに「新規登録」が表示される
    And 名前入力欄が表示される
    And メールアドレス入力欄が表示される
    And 電話番号入力欄が表示される
    And パスワード入力欄が表示される
    And パスワード確認入力欄が表示される
    And 利用規約同意チェックボックスが表示される
    And 「アカウントを作成」ボタンが表示される

  Scenario: ログインページへのリンクが表示される
    Then 「すでにアカウントをお持ちの方はこちら」というリンクが表示される
    And リンクのhrefが「/login」である

  # 成功シナリオ
  Scenario: 全ての必須項目を入力して正常に登録できる
    When 名前に「山田太郎」と入力する
    And メールアドレスに「yamada@example.com」と入力する
    And 電話番号に「090-1234-5678」と入力する
    And パスワードに「password123」と入力する
    And パスワード確認に「password123」と入力する
    And 利用規約に同意する
    And 「アカウントを作成」ボタンをクリックする
    Then 成功メッセージ「Registration successful」が表示される
    And ログインページ「/login」にリダイレクトされる

  Scenario: 電話番号なしでも登録できる（オプション項目）
    When 名前に「田中花子」と入力する
    And メールアドレスに「tanaka@example.com」と入力する
    And パスワードに「securePass123」と入力する
    And パスワード確認に「securePass123」と入力する
    And 利用規約に同意する
    And 「アカウントを作成」ボタンをクリックする
    Then 成功メッセージが表示される
    And ログインページにリダイレクトされる

  # バリデーションエラー - 空欄
  Scenario: 必須項目が空欄の場合エラーが表示される
    When 何も入力せずに「アカウントを作成」ボタンをクリックする
    Then エラーメッセージ「名前を入力してください」が表示される
    And エラーメッセージ「有効なメールアドレスを入力してください」が表示される
    And ページはリダイレクトされない

  Scenario: 名前が空欄の場合エラーが表示される
    When メールアドレスに「test@example.com」と入力する
    And パスワードに「password123」と入力する
    And パスワード確認に「password123」と入力する
    And 利用規約に同意する
    And 「アカウントを作成」ボタンをクリックする
    Then エラーメッセージ「名前を入力してください」が表示される

  Scenario: メールアドレスが空欄の場合エラーが表示される
    When 名前に「テストユーザー」と入力する
    And パスワードに「password123」と入力する
    And パスワード確認に「password123」と入力する
    And 利用規約に同意する
    And 「アカウントを作成」ボタンをクリックする
    Then エラーメッセージ「有効なメールアドレスを入力してください」が表示される

  Scenario: パスワードが空欄の場合エラーが表示される
    When 名前に「テストユーザー」と入力する
    And メールアドレスに「test@example.com」と入力する
    And 利用規約に同意する
    And 「アカウントを作成」ボタンをクリックする
    Then エラーメッセージ「パスワードを入力してください」が表示される

  # バリデーションエラー - パスワード
  Scenario: パスワードが一致しない場合エラーが表示される
    When 名前に「テストユーザー」と入力する
    And メールアドレスに「test@example.com」と入力する
    And パスワードに「password123」と入力する
    And パスワード確認に「different password」と入力する
    And 利用規約に同意する
    And 「アカウントを作成」ボタンをクリックする
    Then エラーメッセージ「パスワードが一致しません」が表示される
    And ページはリダイレクトされない

  Scenario: パスワードが8文字未満の場合エラーが表示される
    When 名前に「テストユーザー」と入力する
    And メールアドレスに「test@example.com」と入力する
    And パスワードに「weak12」と入力する
    And パスワード確認に「weak12」と入力する
    And 利用規約に同意する
    And 「アカウントを作成」ボタンをクリックする
    Then エラーメッセージ「パスワードは8文字以上で入力してください」が表示される
    And ページはリダイレクトされない

  Scenario: パスワード確認が一致しない場合エラーが表示される
    When 名前に「テストユーザー」と入力する
    And メールアドレスに「test@example.com」と入力する
    And パスワードに「password123」と入力する
    And パスワード確認に「password456」と入力する
    And 利用規約に同意する
    And 「アカウントを作成」ボタンをクリックする
    Then エラーメッセージ「パスワードが一致しません」が表示される

  # バリデーションエラー - 利用規約
  Scenario: 利用規約に同意しない場合エラーが表示される
    When 名前に「テストユーザー」と入力する
    And メールアドレスに「test@example.com」と入力する
    And パスワードに「password123」と入力する
    And パスワード確認に「password123」と入力する
    And 利用規約に同意しない
    And 「アカウントを作成」ボタンをクリックする
    Then エラーメッセージ「利用規約に同意してください」が表示される
    And ページはリダイレクトされない

  # バリデーションエラー - メールアドレス形式
  Scenario: 無効なメールアドレス形式の場合エラーが表示される
    When 名前に「テストユーザー」と入力する
    And メールアドレスに「invalid-email」と入力する
    And パスワードに「password123」と入力する
    And パスワード確認に「password123」と入力する
    And 利用規約に同意する
    And 「アカウントを作成」ボタンをクリックする
    Then エラーメッセージ「有効なメールアドレスを入力してください」が表示される

  # リアルタイムバリデーション
  Scenario: フィールドに入力を始めるとそのフィールドのエラーが消える
    Given 何も入力せずに送信してエラーが表示されている
    When 名前に「テスト」と入力する
    Then 名前のエラーメッセージが消える

  # ローディング状態
  Scenario: 送信中はボタンがローディング状態になる
    Given 全ての必須項目を入力している
    When 「アカウントを作成」ボタンをクリックする
    Then ボタンがローディング状態になる
    And ボタンが無効化されている

  # エラーハンドリング
  Scenario: 既に登録済みのメールアドレスでエラーが表示される
    Given メールアドレス「existing@example.com」が既に登録されている
    When 名前に「テストユーザー」と入力する
    And メールアドレスに「existing@example.com」と入力する
    And パスワードに「password123」と入力する
    And パスワード確認に「password123」と入力する
    And 利用規約に同意する
    And 「アカウントを作成」ボタンをクリックする
    Then エラーメッセージ「このメールアドレスは既に登録されています」が表示される

  Scenario: APIエラー時にエラーメッセージが表示される
    Given APIがエラーを返す
    When 全ての必須項目を入力する
    And 「アカウントを作成」ボタンをクリックする
    Then エラーメッセージ「登録に失敗しました」が表示される
    And ページはリダイレクトされない

  Scenario: ネットワークエラー時にエラーメッセージが表示される
    Given ネットワークエラーが発生する
    When 全ての必須項目を入力する
    And 「アカウントを作成」ボタンをクリックする
    Then エラーメッセージ「予期しないエラーが発生しました。もう一度お試しください。」が表示される

  # フォームのクリア
  Scenario: エラー後に再送信できる
    Given バリデーションエラーが表示されている
    When エラーを修正する
    And 「アカウントを作成」ボタンをクリックする
    Then 登録が成功する
    And ログインページにリダイレクトされる

  # アクセシビリティ
  Scenario: すべての入力欄にラベルが設定されている
    Then 名前入力欄にラベルが設定されている
    And メールアドレス入力欄にラベルが設定されている
    And 電話番号入力欄にラベルが設定されている
    And パスワード入力欄にラベルが設定されている
    And パスワード確認入力欄にラベルが設定されている

  Scenario: キーボード操作でフォームを送信できる
    Given 全ての必須項目を入力している
    When 送信ボタンにフォーカスしてEnterキーを押す
    Then フォームが送信される

  # レスポンシブデザイン
  Scenario: モバイルで正しく表示される
    Given モバイル画面サイズ（375x667）に設定している
    When 新規登録ページにアクセスする
    Then フォームが縦1列で表示される
    And すべての入力欄が読みやすく表示される

  Scenario: タブレットで正しく表示される
    Given タブレット画面サイズ（768x1024）に設定している
    When 新規登録ページにアクセスする
    Then フォームが適切に表示される

  Scenario: デスクトップで正しく表示される
    Given デスクトップ画面サイズ（1920x1080）に設定している
    When 新規登録ページにアクセスする
    Then フォームが中央に配置されて表示される
