# language: ja

Feature: 管理者向け予約管理
  管理者として予約の一覧表示・手動追加・編集・削除をしたい

  Issue: #17, #18

  ユーザーストーリー:
  As a store admin
  I want to manage all reservations
  So that I can handle phone bookings and update reservation details

  Background:
    Given 管理者がログインしている
    And 予約一覧ページにアクセスしている

  # 基本表示
  Scenario: 予約一覧ページにアクセスする
    Then ページタイトルに「予約一覧」が表示される
    And 「新規予約を追加」ボタンが表示される

  Scenario: すべての予約が一覧表示される
    Given 予約が5件存在する
    When ページが読み込まれる
    Then 予約一覧テーブルが表示される
    And 各予約に予約日時が表示される
    And 各予約に顧客名が表示される
    And 各予約にメニュー名が表示される
    And 各予約にスタッフ名が表示される
    And 各予約にステータスバッジが表示される
    And 各予約に「編集」ボタンが表示される
    And 各予約に「削除」ボタンが表示される

  Scenario: 予約が存在しない場合
    Given 予約が0件である
    When ページが読み込まれる
    Then 「予約がありません」というメッセージが表示される
    And 「新規予約を追加」ボタンが表示される

  # ステータスフィルタリング
  Scenario: ステータスで予約をフィルタリングできる
    Given 予約一覧ページにアクセスしている
    When ステータスフィルターで「確定」を選択する
    Then 確定済みの予約のみが表示される

  Scenario: 日付範囲で予約をフィルタリングできる
    Given 予約一覧ページにアクセスしている
    When 日付範囲フィルターで「今週」を選択する
    Then 今週の予約のみが表示される

  # 予約手動追加（Issue #17）
  Scenario: 新規予約追加モーダルを開く
    When 「新規予約を追加」ボタンをクリックする
    Then 「新規予約を追加」というタイトルのモーダルが表示される
    And 顧客選択ドロップダウンが表示される
    And メニュー選択ドロップダウンが表示される
    And スタッフ選択ドロップダウンが表示される
    And 日付選択カレンダーが表示される
    And 時間選択ドロップダウンが表示される
    And 備考入力欄が表示される
    And 「予約を作成」ボタンが表示される
    And 「キャンセル」ボタンが表示される

  Scenario: 新規予約追加モーダルを閉じる
    Given 新規予約追加モーダルを開いている
    When 「キャンセル」ボタンをクリックする
    Then モーダルが閉じる

  Scenario: 必須項目が未入力の場合エラーが表示される
    Given 新規予約追加モーダルを開いている
    When 必須項目を入力せずに「予約を作成」ボタンをクリックする
    Then バリデーションエラーメッセージが表示される
    And モーダルは閉じない

  Scenario: 過去の日付を選択できない
    Given 新規予約追加モーダルを開いている
    When カレンダーを表示する
    Then 過去の日付ボタンが無効化されている

  Scenario: 新規予約を正常に追加できる
    Given 新規予約追加モーダルを開いている
    When 顧客に「山田太郎」を選択する
    And メニューに「カット」を選択する
    And スタッフに「田中」を選択する
    And 日付に「明日」を選択する
    And 時間に「10:00」を選択する
    And 備考に「初回来店」と入力する
    And 「予約を作成」ボタンをクリックする
    Then 予約が作成される
    And モーダルが閉じる
    And 成功メッセージ「予約を追加しました」が表示される
    And 予約一覧が更新される

  # 予約編集（Issue #18）
  Scenario: 予約編集モーダルを開く
    Given 予約が1件以上存在する
    When 最初の予約の「編集」ボタンをクリックする
    Then 「予約を編集」というタイトルのモーダルが表示される
    And 既存の予約情報が事前入力されている
    And メニュー選択ドロップダウンが表示される
    And スタッフ選択ドロップダウンが表示される
    And 日付選択カレンダーが表示される
    And 時間選択ドロップダウンが表示される
    And ステータス選択ドロップダウンが表示される
    And 備考入力欄が表示される
    And 「更新する」ボタンが表示される
    And 「キャンセル」ボタンが表示される

  Scenario: 予約編集モーダルを閉じる
    Given 予約編集モーダルを開いている
    When 「キャンセル」ボタンをクリックする
    Then モーダルが閉じる

  Scenario: 予約のステータスを変更できる
    Given 予約編集モーダルを開いている
    When ステータスを「確定」に変更する
    And 「更新する」ボタンをクリックする
    Then 予約が更新される
    And モーダルが閉じる
    And 成功メッセージ「予約を更新しました」が表示される
    And 予約一覧のステータスが更新されている

  Scenario: 予約の日時を変更できる
    Given 予約編集モーダルを開いている
    When 日付を「明後日」に変更する
    And 時間を「14:00」に変更する
    And 「更新する」ボタンをクリックする
    Then 予約が更新される
    And モーダルが閉じる
    And 成功メッセージ「予約を更新しました」が表示される

  Scenario: 予約のメニューとスタッフを変更できる
    Given 予約編集モーダルを開いている
    When メニューを「カラー」に変更する
    And スタッフを「佐藤」に変更する
    And 「更新する」ボタンをクリックする
    Then 予約が更新される
    And モーダルが閉じる
    And 成功メッセージ「予約を更新しました」が表示される

  # 予約削除（Issue #18）
  Scenario: 予約削除確認ダイアログを開く
    Given 予約が1件以上存在する
    When 最初の予約の「削除」ボタンをクリックする
    Then 「予約を削除しますか？」というダイアログが表示される
    And 予約日時が表示される
    And 顧客名が表示される
    And メニュー名が表示される
    And 「この操作は取り消せません」という警告が表示される
    And 「戻る」ボタンが表示される
    And 「削除する」ボタンが表示される

  Scenario: 削除確認ダイアログを閉じる
    Given 削除確認ダイアログを開いている
    When 「戻る」ボタンをクリックする
    Then ダイアログが閉じる

  Scenario: 予約を削除できる
    Given 予約が3件存在する
    And 削除確認ダイアログを開いている
    When 「削除する」ボタンをクリックする
    Then 予約が削除される
    And ダイアログが閉じる
    And 成功メッセージ「予約を削除しました」が表示される
    And 予約一覧から削除された予約が表示されなくなる

  # 検索機能
  Scenario: 顧客名で予約を検索できる
    Given 予約が複数件存在する
    When 検索ボックスに「山田」と入力する
    Then 「山田」を含む顧客の予約のみが表示される

  # ページネーション
  Scenario: 予約が多い場合にページネーションが表示される
    Given 予約が20件以上存在する
    When ページが読み込まれる
    Then ページネーションが表示される
    And 1ページに10件の予約が表示される

  Scenario: 次のページに移動できる
    Given 予約が20件以上存在する
    And ページネーションが表示されている
    When 「次へ」ボタンをクリックする
    Then 2ページ目が表示される

  # レスポンシブデザイン
  Scenario: モバイルで正しく表示される
    Given モバイル画面サイズ（375x667）に設定している
    When 予約一覧ページにアクセスする
    Then テーブルがカード形式で表示される
    And すべての予約情報が読みやすく表示される

  # エラーハンドリング
  Scenario: APIエラー時にエラーメッセージが表示される
    Given APIがエラーを返す
    When 予約一覧ページにアクセスする
    Then 「エラーが発生しました」というメッセージが表示される
    And 「再試行」ボタンが表示される

  Scenario: エラー時に再試行できる
    Given APIがエラーを返している
    And 予約一覧ページにアクセスしている
    When 「再試行」ボタンをクリックする
    And 2回目のAPIリクエストが成功する
    Then エラーメッセージが消える
    And 予約一覧が表示される
