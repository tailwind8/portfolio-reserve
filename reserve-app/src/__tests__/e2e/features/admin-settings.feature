# language: ja

Feature: 店舗設定管理
  管理者として店舗の基本情報と営業設定を管理したい

  Background:
    Given 管理者として認証済みである
    And 店舗設定ページ「/admin/settings」にアクセスしている

  # 基本表示
  Scenario: 店舗設定ページにアクセスする
    Then ページタイトルに「店舗設定」が表示される
    And 店舗基本情報セクションが表示される
    And 営業時間設定セクションが表示される
    And 定休日設定セクションが表示される
    And 予約枠設定セクションが表示される

  # 店舗基本情報
  Scenario: 現在の店舗基本情報が表示される
    When ページが読み込まれる
    Then 店舗名入力フィールドに現在の店舗名が表示される
    And メールアドレス入力フィールドに現在のメールアドレスが表示される
    And 電話番号入力フィールドに現在の電話番号が表示される

  Scenario: 店舗基本情報を更新できる
    When 店舗名を「テストサロン」に変更する
    And メールアドレスを「test@example.com」に変更する
    And 電話番号を「03-1234-5678」に変更する
    And 保存ボタンをクリックする
    Then 「店舗設定を更新しました」という成功メッセージが表示される
    And 店舗名が「テストサロン」に更新される
    And メールアドレスが「test@example.com」に更新される
    And 電話番号が「03-1234-5678」に更新される

  # 営業時間設定
  Scenario: 現在の営業時間が表示される
    When ページが読み込まれる
    Then 開店時刻に現在の値が表示される
    And 閉店時刻に現在の値が表示される

  Scenario: 営業時間を更新できる
    When 開店時刻を「10:00」に変更する
    And 閉店時刻を「22:00」に変更する
    And 保存ボタンをクリックする
    Then 「店舗設定を更新しました」という成功メッセージが表示される
    And 開店時刻が「10:00」に更新される
    And 閉店時刻が「22:00」に更新される

  # 定休日設定
  Scenario: 現在の定休日が表示される
    Given 定休日が「月曜日」に設定されている
    When ページが読み込まれる
    Then 「月曜日」のチェックボックスがチェック済みである

  Scenario: 定休日を追加できる
    When 「月曜日」のチェックボックスをチェックする
    And 「火曜日」のチェックボックスをチェックする
    And 保存ボタンをクリックする
    Then 「店舗設定を更新しました」という成功メッセージが表示される
    And 定休日が「月曜日, 火曜日」に更新される

  Scenario: 定休日を解除できる
    Given 定休日が「月曜日」に設定されている
    When 「月曜日」のチェックボックスのチェックを外す
    And 保存ボタンをクリックする
    Then 「店舗設定を更新しました」という成功メッセージが表示される
    And 定休日が設定されていない

  Scenario: 複数の定休日を設定できる
    When 「日曜日」のチェックボックスをチェックする
    And 「月曜日」のチェックボックスをチェックする
    And 保存ボタンをクリックする
    Then 「店舗設定を更新しました」という成功メッセージが表示される
    And 定休日が「日曜日, 月曜日」に更新される

  # 予約枠設定
  Scenario: 現在の予約枠間隔が表示される
    Given 予約枠間隔が「30分」に設定されている
    When ページが読み込まれる
    Then 予約枠間隔セレクトボックスに「30」が選択されている

  Scenario: 予約枠間隔を変更できる
    When 予約枠間隔を「60分」に変更する
    And 保存ボタンをクリックする
    Then 「店舗設定を更新しました」という成功メッセージが表示される
    And 予約枠間隔が「60分」に更新される

  # バリデーション
  Scenario: 店舗名が必須である
    When 店舗名を空にする
    And 保存ボタンをクリックする
    Then 「店舗名は必須です」というバリデーションエラーが表示される

  Scenario: メールアドレスのフォーマットが検証される
    When メールアドレスを「invalid-email」に変更する
    And 保存ボタンをクリックする
    Then 「有効なメールアドレスを入力してください」というバリデーションエラーが表示される

  Scenario: 開店時刻が閉店時刻より前である必要がある
    When 開店時刻を「20:00」に変更する
    And 閉店時刻を「10:00」に変更する
    And 保存ボタンをクリックする
    Then 「開店時刻は閉店時刻より前である必要があります」というバリデーションエラーが表示される

  # エラーハンドリング
  Scenario: ネットワークエラー時にエラーメッセージが表示される
    Given ネットワークエラーが発生する
    When 保存ボタンをクリックする
    Then 「設定の更新に失敗しました」というエラーメッセージが表示される

  # ローディング状態
  Scenario: 保存中はローディングインジケーターが表示される
    When 保存ボタンをクリックする
    Then 保存ボタンが無効化される
    And ローディングインジケーターが表示される
    And 保存処理が完了すると保存ボタンが有効化される

  # レスポンシブデザイン
  Scenario: モバイルで正しく表示される
    Given モバイル画面サイズ（375x667）に設定している
    When 店舗設定ページにアクセスする
    Then すべての設定セクションが縦1列で表示される
    And すべての入力フィールドが読みやすく表示される

  Scenario: タブレットで正しく表示される
    Given タブレット画面サイズ（768x1024）に設定している
    When 店舗設定ページにアクセスする
    Then 設定セクションが適切にレイアウトされる

  # 設定の永続化
  Scenario: ページをリロードしても設定が保持される
    Given 店舗名を「永続化テスト」に変更して保存した
    When ページをリロードする
    Then 店舗名が「永続化テスト」のまま表示される

  # 権限チェック
  Scenario: 非管理者はアクセスできない
    Given 非管理者としてログインしている
    When 店舗設定ページにアクセスしようとする
    Then ログインページにリダイレクトされる
    Or アクセス拒否メッセージが表示される
