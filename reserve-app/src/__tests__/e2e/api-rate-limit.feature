# language: ja
機能: APIレート制限
  DDoS攻撃やブルートフォース攻撃からシステムを保護するため、
  APIエンドポイントにレート制限を実装する。

  背景:
    前提 システムが正常に稼働している

  シナリオ: ログインAPIのレート制限（10リクエスト/分/IP）
    前提 ログインAPIに対してレート制限が設定されている
    もし 同一IPアドレスから1分以内に10回ログインリクエストを送信する
    ならば 最初の10回は正常にレスポンスを返す
    かつ 11回目のリクエストは429エラーを返す
    かつ レスポンスヘッダーに"Retry-After"が含まれる

  シナリオ: 登録APIのレート制限（5リクエスト/時間/IP）
    前提 登録APIに対してレート制限が設定されている
    もし 同一IPアドレスから1時間以内に5回登録リクエストを送信する
    ならば 最初の5回は正常にレスポンスを返す
    かつ 6回目のリクエストは429エラーを返す
    かつ レスポンスヘッダーに"Retry-After"が含まれる

  シナリオ: ログアウトAPIのレート制限（20リクエスト/分/IP）
    前提 ログアウトAPIに対してレート制限が設定されている
    もし 同一IPアドレスから1分以内に20回ログアウトリクエストを送信する
    ならば 最初の20回は正常にレスポンスを返す
    かつ 21回目のリクエストは429エラーを返す

  シナリオ: レート制限のリセット
    前提 ログインAPIでレート制限に達している
    もし 1分間待機する
    ならば 再度ログインリクエストが成功する

  シナリオ: 異なるIPアドレスからのリクエストは独立してカウント
    前提 IPアドレスAからログインAPIに10回リクエストを送信した
    かつ IPアドレスAは レート制限に達している
    もし IPアドレスBからログインリクエストを送信する
    ならば リクエストは成功する

  シナリオ: レート制限エラーレスポンスの形式
    前提 ログインAPIに対してレート制限が設定されている
    もし レート制限を超過するリクエストを送信する
    ならば ステータスコード429が返される
    かつ エラーメッセージに"Too many requests"が含まれる
    かつ レスポンスヘッダーに"X-RateLimit-Limit"が含まれる
    かつ レスポンスヘッダーに"X-RateLimit-Remaining"が含まれる
    かつ レスポンスヘッダーに"X-RateLimit-Reset"が含まれる
