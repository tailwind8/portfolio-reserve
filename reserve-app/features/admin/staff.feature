# language: ja
Feature: スタッフ管理
  As a store admin
  I want to manage staff members and their shifts
  So that I can schedule reservations effectively

  Background:
    Given 管理者がログインしている

  Scenario: スタッフ一覧を表示（ハッピーパス）
    Given 管理者がスタッフ管理ページにアクセスしている
    When ページが読み込まれる
    Then すべてのスタッフが一覧表示される
    And 各スタッフに名前が表示される
    And 各スタッフにメールアドレスが表示される
    And 各スタッフに電話番号が表示される
    And 各スタッフの出勤状況が表示される

  Scenario: スタッフを追加（ハッピーパス）
    Given 管理者がスタッフ管理ページにアクセスしている
    When "スタッフを追加"ボタンをクリックする
    Then スタッフ追加モーダルが表示される
    When 名前に"佐藤花子"を入力する
    And メールアドレスに"sato@example.com"を入力する
    And 電話番号に"090-1111-2222"を入力する
    And "追加"ボタンをクリックする
    Then スタッフが追加される
    And 成功メッセージが表示される
    And スタッフ一覧に新しいスタッフが表示される

  Scenario: スタッフ追加失敗（必須項目未入力）
    Given 管理者がスタッフ管理ページにアクセスしている
    When "スタッフを追加"ボタンをクリックする
    Then スタッフ追加モーダルが表示される
    When 何も入力せずに"追加"ボタンをクリックする
    Then エラーメッセージ"名前を入力してください"が表示される
    And エラーメッセージ"メールアドレスを入力してください"が表示される
    And スタッフは追加されない

  Scenario: スタッフ追加失敗（メールアドレス重複）
    Given 管理者がスタッフ管理ページにアクセスしている
    And メールアドレス"sato@example.com"のスタッフが既に存在する
    When "スタッフを追加"ボタンをクリックする
    Then スタッフ追加モーダルが表示される
    When 名前に"佐藤花子"を入力する
    And メールアドレスに"sato@example.com"を入力する
    And "追加"ボタンをクリックする
    Then エラーメッセージ"このメールアドレスは既に登録されています"が表示される
    And スタッフは追加されない

  Scenario: スタッフを編集（ハッピーパス）
    Given 管理者がスタッフ管理ページにアクセスしている
    And スタッフが1件以上存在する
    When スタッフを選択する
    And "編集"ボタンをクリックする
    Then スタッフ編集モーダルが表示される
    When 電話番号を"090-3333-4444"に変更する
    And "保存"ボタンをクリックする
    Then スタッフ情報が更新される
    And 成功メッセージが表示される

  Scenario: スタッフを削除（ハッピーパス）
    Given 管理者がスタッフ管理ページにアクセスしている
    And スタッフが1件以上存在する
    When スタッフを選択する
    And "削除"ボタンをクリックする
    Then "スタッフを削除しますか？"という確認ダイアログが表示される
    When 確認ダイアログで"はい"を選択する
    Then スタッフが削除される
    And 成功メッセージが表示される
    And スタッフ一覧から該当スタッフが削除される

  Scenario: スタッフ削除失敗（予約が存在する）
    Given 管理者がスタッフ管理ページにアクセスしている
    And スタッフが1件以上存在する
    And 該当スタッフに予約が存在する
    When スタッフを選択する
    And "削除"ボタンをクリックしようとする
    Then "削除"ボタンが無効化されている
    And エラーメッセージ"予約が存在するため削除できません"が表示される

  Scenario: スタッフシフト設定（ハッピーパス）
    Given 管理者がスタッフ管理ページにアクセスしている
    And スタッフが1件以上存在する
    When スタッフを選択する
    And "シフト設定"ボタンをクリックする
    Then シフト設定モーダルが表示される
    When 月曜日の出勤時間"09:00"を設定する
    And 月曜日の退勤時間"18:00"を設定する
    And 月曜日のチェックボックスをチェックする
    And "保存"ボタンをクリックする
    Then シフトが保存される
    And 成功メッセージが表示される

  Scenario: スタッフシフト設定（複数曜日）
    Given 管理者がスタッフ管理ページにアクセスしている
    And スタッフが1件以上存在する
    When スタッフを選択する
    And "シフト設定"ボタンをクリックする
    Then シフト設定モーダルが表示される
    When 月曜日のチェックボックスをチェックする
    And 月曜日の出勤時間"09:00"を設定する
    And 月曜日の退勤時間"18:00"を設定する
    And 水曜日のチェックボックスをチェックする
    And 水曜日の出勤時間"10:00"を設定する
    And 水曜日の退勤時間"19:00"を設定する
    And "保存"ボタンをクリックする
    Then シフトが保存される
    And 月曜日と水曜日のシフトが設定される

  Scenario: スタッフシフト設定（休暇設定）
    Given 管理者がスタッフ管理ページにアクセスしている
    And スタッフが1件以上存在する
    When スタッフを選択する
    And "シフト設定"ボタンをクリックする
    Then シフト設定モーダルが表示される
    When "休暇設定"タブをクリックする
    And 休暇開始日"2025年1月25日"を選択する
    And 休暇終了日"2025年1月27日"を選択する
    And "保存"ボタンをクリックする
    Then 休暇が設定される
    And 成功メッセージが表示される

  Scenario: スタッフシフト設定（時間外設定）
    Given 管理者がスタッフ管理ページにアクセスしている
    And スタッフが1件以上存在する
    When スタッフを選択する
    And "シフト設定"ボタンをクリックする
    Then シフト設定モーダルが表示される
    When 月曜日の出勤時間"22:00"を設定する
    And 月曜日の退勤時間"09:00"を設定する
    And "保存"ボタンをクリックする
    Then エラーメッセージ"退勤時間は出勤時間より後である必要があります"が表示される
    And シフトは保存されない

  Scenario: スタッフの出勤状況を表示
    Given 管理者がスタッフ管理ページにアクセスしている
    When ページが読み込まれる
    Then 各スタッフの出勤状況が表示される
    And "勤務中"のスタッフには緑色のインジケータが表示される
    And "休憩中"のスタッフには黄色のインジケータが表示される
    And "退勤"のスタッフには灰色のインジケータが表示される

  Scenario: スタッフ一覧が空の場合
    Given 管理者がスタッフ管理ページにアクセスしている
    And スタッフが0件である
    When ページが読み込まれる
    Then "スタッフが登録されていません"というメッセージが表示される

  Scenario: スタッフ検索機能
    Given 管理者がスタッフ管理ページにアクセスしている
    When 検索ボックスに"佐藤"と入力する
    Then "佐藤"を含むスタッフ名のスタッフのみが表示される

