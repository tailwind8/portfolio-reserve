# language: ja
Feature: 予約管理（管理者）
  As a store admin
  I want to view and manage all reservations
  So that I can manage bookings effectively

  Background:
    Given 管理者がログインしている

  Scenario: 予約一覧を表示（ハッピーパス）
    Given 管理者が予約管理ページにアクセスしている
    When ページが読み込まれる
    Then すべての予約が一覧表示される
    And 各予約に日時が表示される
    And 各予約に顧客名が表示される
    And 各予約にメニューが表示される
    And 各予約にスタッフ名が表示される
    And 各予約にステータスが表示される

  Scenario: 日付でフィルタリングできる
    Given 管理者が予約管理ページにアクセスしている
    When 日付フィルターで"2025年1月20日"を選択する
    Then "2025年1月20日"の予約のみが表示される

  Scenario: ステータスでフィルタリングできる
    Given 管理者が予約管理ページにアクセスしている
    When ステータスフィルターで"予約確定"を選択する
    Then "予約確定"ステータスの予約のみが表示される

  Scenario: 日付とステータスで同時にフィルタリングできる
    Given 管理者が予約管理ページにアクセスしている
    When 日付フィルターで"2025年1月20日"を選択する
    And ステータスフィルターで"予約確定"を選択する
    Then "2025年1月20日"かつ"予約確定"の予約のみが表示される

  Scenario: 予約手動追加（ハッピーパス）
    Given 管理者が予約管理ページにアクセスしている
    When "新規予約を追加"ボタンをクリックする
    Then 予約追加モーダルが表示される
    When 顧客を選択する
    And メニューを選択する
    And スタッフを選択する
    And 日付"2025年1月25日"を選択する
    And 時間帯"14:00"を選択する
    And "追加"ボタンをクリックする
    Then 予約が追加される
    And 成功メッセージが表示される
    And 予約一覧に新しい予約が表示される

  Scenario: 予約手動追加（電話予約）
    Given 管理者が予約管理ページにアクセスしている
    When "新規予約を追加"ボタンをクリックする
    Then 予約追加モーダルが表示される
    When 新規顧客情報を入力する
    And 名前"山田太郎"を入力する
    And 電話番号"090-1234-5678"を入力する
    And メールアドレス"yamada@example.com"を入力する
    And メニューを選択する
    And スタッフを選択する
    And 日付"2025年1月25日"を選択する
    And 時間帯"14:00"を選択する
    And "追加"ボタンをクリックする
    Then 新規顧客が作成される
    And 予約が追加される
    And 成功メッセージが表示される

  Scenario: 予約手動追加失敗（必須項目未入力）
    Given 管理者が予約管理ページにアクセスしている
    When "新規予約を追加"ボタンをクリックする
    Then 予約追加モーダルが表示される
    When 何も入力せずに"追加"ボタンをクリックする
    Then エラーメッセージ"顧客を選択してください"が表示される
    And エラーメッセージ"メニューを選択してください"が表示される
    And 予約は追加されない

  Scenario: 予約手動追加失敗（重複予約）
    Given 管理者が予約管理ページにアクセスしている
    And "2025年1月20日 14:00"の時間帯が既に予約済みである
    When "新規予約を追加"ボタンをクリックする
    Then 予約追加モーダルが表示される
    When 顧客を選択する
    And メニューを選択する
    And スタッフを選択する
    And 日付"20日"を選択する
    And 時間帯"14:00"を選択する
    And "追加"ボタンをクリックする
    Then エラーメッセージ"この時間は既に予約済みです"が表示される
    And 予約は追加されない

  Scenario: 予約編集（ハッピーパス）
    Given 管理者が予約管理ページにアクセスしている
    And 予約が1件以上存在する
    When 予約を選択する
    And "編集"ボタンをクリックする
    Then 予約編集モーダルが表示される
    When 日付"25日"に変更する
    And 時間帯"16:00"に変更する
    And "保存"ボタンをクリックする
    Then 予約が更新される
    And 成功メッセージが表示される
    And 予約一覧が更新される

  Scenario: 予約編集（ステータス変更）
    Given 管理者が予約管理ページにアクセスしている
    And 予約が1件以上存在する
    When 予約を選択する
    And "編集"ボタンをクリックする
    Then 予約編集モーダルが表示される
    When ステータスを"来店済み"に変更する
    And "保存"ボタンをクリックする
    Then 予約のステータスが更新される
    And 成功メッセージが表示される

  Scenario: 予約削除（ハッピーパス）
    Given 管理者が予約管理ページにアクセスしている
    And 予約が1件以上存在する
    When 予約を選択する
    And "削除"ボタンをクリックする
    Then "予約を削除しますか？"という確認ダイアログが表示される
    When 確認ダイアログで"はい"を選択する
    Then 予約が削除される
    And 成功メッセージが表示される
    And 予約一覧から該当予約が削除される

  Scenario: 予約削除（取り消し）
    Given 管理者が予約管理ページにアクセスしている
    And 予約が1件以上存在する
    When 予約を選択する
    And "削除"ボタンをクリックする
    Then 確認ダイアログが表示される
    When 確認ダイアログで"いいえ"を選択する
    Then 予約は削除されない
    And 予約一覧に予約が残っている

  Scenario: 予約詳細を表示
    Given 管理者が予約管理ページにアクセスしている
    And 予約が1件以上存在する
    When 予約をクリックする
    Then 予約詳細モーダルが表示される
    And 予約の全情報が表示される
    And 顧客情報が表示される
    And 来店履歴が表示される

  Scenario: 予約一覧のソート機能
    Given 管理者が予約管理ページにアクセスしている
    When "日付"でソートする
    Then 予約が日付順に並び替えられる
    When "顧客名"でソートする
    Then 予約が顧客名順に並び替えられる

  Scenario: 予約一覧が空の場合
    Given 管理者が予約管理ページにアクセスしている
    And 予約が0件である
    When ページが読み込まれる
    Then "予約がありません"というメッセージが表示される

  Scenario: 予約検索機能
    Given 管理者が予約管理ページにアクセスしている
    When 検索ボックスに"山田"と入力する
    Then "山田"を含む顧客名の予約のみが表示される

