# language: ja
Feature: メニュー管理
  As a store admin
  I want to manage menus
  So that I can offer services to customers

  Background:
    Given 管理者がログインしている

  Scenario: メニュー一覧を表示（ハッピーパス）
    Given 管理者がメニュー管理ページにアクセスしている
    When ページが読み込まれる
    Then すべてのメニューが一覧表示される
    And 各メニューに名前が表示される
    And 各メニューにカテゴリが表示される
    And 各メニューに料金が表示される
    And 各メニューに所要時間が表示される
    And 各メニューに説明が表示される

  Scenario: メニューを追加（ハッピーパス）
    Given 管理者がメニュー管理ページにアクセスしている
    When "メニューを追加"ボタンをクリックする
    Then メニュー追加モーダルが表示される
    When 名前に"カット+カラー"を入力する
    And カテゴリで"ヘアカット"を選択する
    And 料金に"8000"を入力する
    And 所要時間に"120"を入力する
    And 説明に"カットとカラーをセットにしたメニューです"を入力する
    And "追加"ボタンをクリックする
    Then メニューが追加される
    And 成功メッセージが表示される
    And メニュー一覧に新しいメニューが表示される

  Scenario: メニュー追加失敗（必須項目未入力）
    Given 管理者がメニュー管理ページにアクセスしている
    When "メニューを追加"ボタンをクリックする
    Then メニュー追加モーダルが表示される
    When 何も入力せずに"追加"ボタンをクリックする
    Then エラーメッセージ"名前を入力してください"が表示される
    And エラーメッセージ"料金を入力してください"が表示される
    And エラーメッセージ"所要時間を入力してください"が表示される
    And メニューは追加されない

  Scenario: メニュー追加失敗（料金が不正）
    Given 管理者がメニュー管理ページにアクセスしている
    When "メニューを追加"ボタンをクリックする
    Then メニュー追加モーダルが表示される
    When 名前に"カット"を入力する
    And 料金に"-1000"を入力する
    And "追加"ボタンをクリックする
    Then エラーメッセージ"料金は0以上の数値である必要があります"が表示される
    And メニューは追加されない

  Scenario: メニューを編集（ハッピーパス）
    Given 管理者がメニュー管理ページにアクセスしている
    And メニューが1件以上存在する
    When メニューを選択する
    And "編集"ボタンをクリックする
    Then メニュー編集モーダルが表示される
    When 料金を"6000"に変更する
    And "保存"ボタンをクリックする
    Then メニュー情報が更新される
    And 成功メッセージが表示される

  Scenario: メニューを削除（ハッピーパス）
    Given 管理者がメニュー管理ページにアクセスしている
    And メニューが1件以上存在する
    When メニューを選択する
    And "削除"ボタンをクリックする
    Then "メニューを削除しますか？"という確認ダイアログが表示される
    When 確認ダイアログで"はい"を選択する
    Then メニューが削除される
    And 成功メッセージが表示される
    And メニュー一覧から該当メニューが削除される

  Scenario: メニュー削除失敗（予約が存在する）
    Given 管理者がメニュー管理ページにアクセスしている
    And メニューが1件以上存在する
    And 該当メニューに予約が存在する
    When メニューを選択する
    And "削除"ボタンをクリックしようとする
    Then "削除"ボタンが無効化されている
    And エラーメッセージ"予約が存在するため削除できません"が表示される

  Scenario: メニューを非アクティブにする
    Given 管理者がメニュー管理ページにアクセスしている
    And メニューが1件以上存在する
    When メニューを選択する
    And "非アクティブにする"ボタンをクリックする
    Then メニューが非アクティブになる
    And 成功メッセージが表示される
    And メニュー一覧で非アクティブとして表示される
    And 顧客向けメニュー一覧には表示されない

  Scenario: メニューをアクティブにする
    Given 管理者がメニュー管理ページにアクセスしている
    And 非アクティブなメニューが1件以上存在する
    When 非アクティブなメニューを選択する
    And "アクティブにする"ボタンをクリックする
    Then メニューがアクティブになる
    And 成功メッセージが表示される
    And 顧客向けメニュー一覧に表示される

  Scenario: カテゴリでフィルタリングできる
    Given 管理者がメニュー管理ページにアクセスしている
    When カテゴリフィルターで"ヘアカット"を選択する
    Then "ヘアカット"カテゴリのメニューのみが表示される

  Scenario: メニュー検索機能
    Given 管理者がメニュー管理ページにアクセスしている
    When 検索ボックスに"カット"と入力する
    Then "カット"を含むメニュー名のメニューのみが表示される

  Scenario: メニュー一覧が空の場合
    Given 管理者がメニュー管理ページにアクセスしている
    And メニューが0件である
    When ページが読み込まれる
    Then "メニューが登録されていません"というメッセージが表示される

  Scenario: メニューの並び順を変更
    Given 管理者がメニュー管理ページにアクセスしている
    And メニューが2件以上存在する
    When メニューの並び順を変更する
    And "保存"ボタンをクリックする
    Then メニューの並び順が保存される
    And 成功メッセージが表示される

