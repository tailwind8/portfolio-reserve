# language: ja
Feature: メニュー管理
  Issue: #23

  ユーザーストーリー:
  As a store admin
  I want to manage service menus
  So that customers can select services when making reservations

  Background:
    Given 管理者がログインしている
    And 管理者がメニュー管理ページにアクセスしている

  Scenario: メニュー一覧を表示（ハッピーパス）
    Given メニューが複数件登録されている
    When ページが読み込まれる
    Then すべてのメニューが一覧表示される
    And 各メニューに名前が表示される
    And 各メニューに価格が表示される
    And 各メニューに所要時間が表示される
    And 各メニューにカテゴリが表示される

  Scenario: メニューを追加（ハッピーパス）
    Given 管理者がメニュー管理ページにアクセスしている
    When "メニューを追加"ボタンをクリックする
    Then メニュー追加モーダルが表示される
    When 名前に"カット"を入力する
    And 価格に"5000"を入力する
    And 所要時間に"60"を入力する
    And カテゴリに"ヘアケア"を入力する
    And 説明に"シャンプー・ブロー込み"を入力する
    And "追加"ボタンをクリックする
    Then メニューが追加される
    And 成功メッセージ"メニューを追加しました"が表示される
    And メニュー一覧に新しいメニューが表示される

  Scenario: メニュー追加失敗（必須項目未入力）
    Given 管理者がメニュー管理ページにアクセスしている
    When "メニューを追加"ボタンをクリックする
    Then メニュー追加モーダルが表示される
    When 何も入力せずに"追加"ボタンをクリックする
    Then エラーメッセージ"名前を入力してください"が表示される
    And エラーメッセージ"価格を入力してください"が表示される
    And エラーメッセージ"所要時間を入力してください"が表示される
    And メニューは追加されない

  Scenario: メニュー追加失敗（価格が不正）
    Given 管理者がメニュー管理ページにアクセスしている
    When "メニューを追加"ボタンをクリックする
    Then メニュー追加モーダルが表示される
    When 名前に"カット"を入力する
    And 価格に"-1000"を入力する
    And 所要時間に"60"を入力する
    And "追加"ボタンをクリックする
    Then エラーメッセージ"価格は0以上の数値を入力してください"が表示される
    And メニューは追加されない

  Scenario: メニューを編集（ハッピーパス）
    Given 管理者がメニュー管理ページにアクセスしている
    And メニューが1件以上存在する
    When メニューを選択する
    And "編集"ボタンをクリックする
    Then メニュー編集モーダルが表示される
    When 価格を"6000"に変更する
    And "保存"ボタンをクリックする
    Then メニュー情報が更新される
    And 成功メッセージ"メニュー情報を更新しました"が表示される

  Scenario: メニューを削除（ハッピーパス）
    Given 管理者がメニュー管理ページにアクセスしている
    And メニューが1件以上存在する
    When メニューを選択する
    And "削除"ボタンをクリックする
    Then "メニューを削除しますか？"という確認ダイアログが表示される
    When 確認ダイアログで"はい"を選択する
    Then メニューが削除される
    And 成功メッセージ"メニューを削除しました"が表示される
    And メニュー一覧から該当メニューが削除される

  Scenario: メニュー削除失敗（予約が存在する）
    Given 管理者がメニュー管理ページにアクセスしている
    And メニューが1件以上存在する
    And 該当メニューに予約が存在する
    When メニューを選択する
    And "削除"ボタンをクリックしようとする
    Then "削除"ボタンが無効化されている
    And エラーメッセージ"予約が存在するため削除できません"が表示される

  Scenario: カテゴリ別フィルター
    Given 管理者がメニュー管理ページにアクセスしている
    And 複数のカテゴリのメニューが存在する
    When カテゴリフィルターで"ヘアケア"を選択する
    Then "ヘアケア"カテゴリのメニューのみが表示される

  Scenario: メニュー一覧が空の場合
    Given 管理者がメニュー管理ページにアクセスしている
    And メニューが0件である
    When ページが読み込まれる
    Then "メニューが登録されていません"というメッセージが表示される

  Scenario: メニュー検索機能
    Given 管理者がメニュー管理ページにアクセスしている
    When 検索ボックスに"カット"と入力する
    Then "カット"を含むメニュー名のメニューのみが表示される

  Scenario: メニューの有効/無効切り替え
    Given 管理者がメニュー管理ページにアクセスしている
    And メニューが1件以上存在する
    When メニューを選択する
    And "無効にする"ボタンをクリックする
    Then メニューが無効状態になる
    And 成功メッセージ"メニューを無効にしました"が表示される
    And メニュー一覧で無効状態が表示される
