# language: ja
Feature: 顧客管理
  As a store admin
  I want to view customer information
  So that I can provide personalized service

  Background:
    Given 管理者がログインしている

  Scenario: 顧客一覧を表示（ハッピーパス）
    Given 管理者が顧客管理ページにアクセスしている
    When ページが読み込まれる
    Then すべての顧客が一覧表示される
    And 各顧客に名前が表示される
    And 各顧客にメールアドレスが表示される
    And 各顧客に電話番号が表示される
    And 各顧客に来店回数が表示される
    And 各顧客に最終来店日が表示される

  Scenario: 顧客詳細を表示
    Given 管理者が顧客管理ページにアクセスしている
    And 顧客が1件以上存在する
    When 顧客をクリックする
    Then 顧客詳細ページに遷移する
    And 顧客の基本情報が表示される
    And 来店履歴が表示される
    And 予約履歴が表示される

  Scenario: 来店履歴を表示
    Given 管理者が顧客詳細ページにアクセスしている
    When ページが読み込まれる
    Then 来店履歴一覧が表示される
    And 各来店履歴に日時が表示される
    And 各来店履歴にメニューが表示される
    And 各来店履歴にスタッフ名が表示される
    And 各来店履歴に料金が表示される

  Scenario: 顧客メモを追加（ハッピーパス）
    Given 管理者が顧客詳細ページにアクセスしている
    When "メモを追加"ボタンをクリックする
    Then メモ入力欄が表示される
    When メモに"アレルギー：なし。好みの席：窓際"と入力する
    And "保存"ボタンをクリックする
    Then メモが保存される
    And 成功メッセージが表示される
    And メモが顧客詳細に表示される

  Scenario: 顧客メモを編集
    Given 管理者が顧客詳細ページにアクセスしている
    And メモが既に存在する
    When "メモを編集"ボタンをクリックする
    Then メモ入力欄が編集可能になる
    When メモを"アレルギー：なし。好みの席：窓際。前回の要望：静かな席を希望"に変更する
    And "保存"ボタンをクリックする
    Then メモが更新される
    And 成功メッセージが表示される

  Scenario: 顧客メモを削除
    Given 管理者が顧客詳細ページにアクセスしている
    And メモが既に存在する
    When "メモを削除"ボタンをクリックする
    Then "メモを削除しますか？"という確認ダイアログが表示される
    When 確認ダイアログで"はい"を選択する
    Then メモが削除される
    And 成功メッセージが表示される

  Scenario: 顧客情報を編集
    Given 管理者が顧客詳細ページにアクセスしている
    When "顧客情報を編集"ボタンをクリックする
    Then 顧客情報編集モーダルが表示される
    When 電話番号を"090-9999-8888"に変更する
    And "保存"ボタンをクリックする
    Then 顧客情報が更新される
    And 成功メッセージが表示される

  Scenario: 顧客検索機能
    Given 管理者が顧客管理ページにアクセスしている
    When 検索ボックスに"山田"と入力する
    Then "山田"を含む顧客名の顧客のみが表示される

  Scenario: 顧客一覧のソート機能
    Given 管理者が顧客管理ページにアクセスしている
    When "来店回数"でソートする
    Then 顧客が来店回数順に並び替えられる
    When "最終来店日"でソートする
    Then 顧客が最終来店日順に並び替えられる

  Scenario: 顧客一覧が空の場合
    Given 管理者が顧客管理ページにアクセスしている
    And 顧客が0件である
    When ページが読み込まれる
    Then "顧客が登録されていません"というメッセージが表示される

  Scenario: 顧客の予約履歴を表示
    Given 管理者が顧客詳細ページにアクセスしている
    When "予約履歴"タブをクリックする
    Then 予約履歴一覧が表示される
    And 各予約に日時が表示される
    And 各予約にメニューが表示される
    And 各予約にステータスが表示される

  Scenario: 顧客メモの文字数制限
    Given 管理者が顧客詳細ページにアクセスしている
    When "メモを追加"ボタンをクリックする
    Then メモ入力欄が表示される
    When メモに1000文字を超えるテキストを入力しようとする
    Then メモ入力欄が500文字までに制限される
    And 文字カウンター"500/500文字"が表示される

  Scenario: 顧客メモの表示（長文）
    Given 管理者が顧客詳細ページにアクセスしている
    And 長文のメモが存在する
    When ページが読み込まれる
    Then メモが表示される
    And "続きを読む"ボタンが表示される
    When "続きを読む"ボタンをクリックする
    Then メモの全文が表示される

