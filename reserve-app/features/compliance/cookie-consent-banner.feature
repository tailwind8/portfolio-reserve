# language: ja
機能: Cookie同意バナー

  アプリケーションでは、Cookie利用の通知と同意取得を適切に行う必要がある。
  初回アクセス時にCookie同意バナーを表示し、ユーザーの同意を得た後は
  LocalStorageに保存して再表示しないようにする。

  背景:
    前提 ユーザーがアプリケーションにアクセスする

  # 初回アクセス時の表示
  シナリオ: 初回アクセス時にCookie同意バナーが表示される
    前提 ユーザーが初めてサイトにアクセスする
    かつ LocalStorageに同意情報が保存されていない
    もし ホームページにアクセスする
    ならば Cookie同意バナーが表示される
    かつ バナーに"Cookie"という文言が含まれる
    かつ "同意する"ボタンが表示される
    かつ "プライバシーポリシー"リンクが表示される

  # 同意後の動作
  シナリオ: 同意ボタンをクリックするとバナーが消える
    前提 ユーザーが初めてサイトにアクセスする
    かつ Cookie同意バナーが表示されている
    もし "同意する"ボタンをクリックする
    ならば Cookie同意バナーが非表示になる
    かつ LocalStorageに同意情報が保存される

  # LocalStorage保存確認
  シナリオ: 同意情報がLocalStorageに正しく保存される
    前提 ユーザーが初めてサイトにアクセスする
    かつ Cookie同意バナーが表示されている
    もし "同意する"ボタンをクリックする
    ならば LocalStorageに"cookieConsent"キーが保存される
    かつ 保存された値が"accepted"である

  # 再訪問時の動作
  シナリオ: 同意済みのユーザーには再表示されない
    前提 ユーザーが過去にCookieに同意している
    かつ LocalStorageに同意情報が保存されている
    もし ホームページにアクセスする
    ならば Cookie同意バナーが表示されない

  シナリオ: 同意後に別のページに移動してもバナーは表示されない
    前提 ユーザーが初めてサイトにアクセスする
    かつ Cookie同意バナーが表示されている
    もし "同意する"ボタンをクリックする
    かつ "/menus"ページに移動する
    ならば Cookie同意バナーが表示されない

  シナリオ: 同意後にページをリロードしてもバナーは表示されない
    前提 ユーザーが初めてサイトにアクセスする
    かつ Cookie同意バナーが表示されている
    もし "同意する"ボタンをクリックする
    かつ ページをリロードする
    ならば Cookie同意バナーが表示されない

  # プライバシーポリシーリンク
  シナリオ: プライバシーポリシーリンクが機能する
    前提 ユーザーが初めてサイトにアクセスする
    かつ Cookie同意バナーが表示されている
    もし "プライバシーポリシー"リンクをクリックする
    ならば "/privacy"ページに遷移する

  # バナーのUI要素
  シナリオ: Cookie同意バナーに必要な情報が含まれる
    前提 ユーザーが初めてサイトにアクセスする
    かつ Cookie同意バナーが表示されている
    ならば バナーに"Cookie"という文言が含まれる
    かつ バナーに利用目的の説明が含まれる
    かつ バナーがページの下部に固定表示される

  # アクセシビリティ
  シナリオ: Cookie同意バナーがキーボードで操作できる
    前提 ユーザーが初めてサイトにアクセスする
    かつ Cookie同意バナーが表示されている
    もし Tabキーで"同意する"ボタンにフォーカスする
    かつ Enterキーを押す
    ならば Cookie同意バナーが非表示になる
    かつ LocalStorageに同意情報が保存される

  # LocalStorageクリア時の動作
  シナリオ: LocalStorageをクリアすると再度バナーが表示される
    前提 ユーザーが過去にCookieに同意している
    かつ LocalStorageに同意情報が保存されている
    もし LocalStorageをクリアする
    かつ ページをリロードする
    ならば Cookie同意バナーが表示される

  # 複数ブラウザ対応
  シナリオ: 異なるブラウザでは独立して同意が管理される
    前提 ユーザーがブラウザAでCookieに同意している
    もし ブラウザBで初めてサイトにアクセスする
    ならば Cookie同意バナーが表示される

  # レスポンシブデザイン
  シナリオ: モバイル画面でもCookie同意バナーが適切に表示される
    前提 ユーザーがモバイルデバイスでアクセスする
    かつ 初めてサイトにアクセスする
    もし ホームページにアクセスする
    ならば Cookie同意バナーが表示される
    かつ バナーがモバイル画面に収まっている
    かつ "同意する"ボタンがタップしやすいサイズである
