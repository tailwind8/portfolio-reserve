# language: ja
Feature: パスワードリセット
  As a customer
  I want to reset my password
  So that I can regain access to my account

  Background:
    Given パスワードリセットページにアクセスしている

  Scenario: パスワードリセット申請成功（ハッピーパス）
    Given 登録済みユーザー"yamada@example.com"が存在する
    When メールアドレスに"yamada@example.com"を入力する
    And "パスワードリセットメールを送信"ボタンをクリックする
    Then パスワードリセットメールが送信される
    And 成功メッセージ"パスワードリセットメールを送信しました"が表示される

  Scenario: パスワードリセット申請失敗（存在しないメールアドレス）
    When メールアドレスに"nonexistent@example.com"を入力する
    And "パスワードリセットメールを送信"ボタンをクリックする
    Then エラーメッセージ"このメールアドレスは登録されていません"が表示される

  Scenario: パスワードリセット申請失敗（メールアドレス未入力）
    When 何も入力せずに"パスワードリセットメールを送信"ボタンをクリックする
    Then エラーメッセージ"メールアドレスを入力してください"が表示される

  Scenario: パスワードリセット申請失敗（無効なメールアドレス形式）
    When メールアドレスに"invalid-email"を入力する
    And "パスワードリセットメールを送信"ボタンをクリックする
    Then エラーメッセージ"有効なメールアドレスを入力してください"が表示される

  Scenario: パスワードリセットリンクから新パスワード設定（ハッピーパス）
    Given パスワードリセットリンクにアクセスしている
    And リンクが有効である
    When 新しいパスワードに"newPassword123"を入力する
    And パスワード確認に"newPassword123"を入力する
    And "パスワードを変更"ボタンをクリックする
    Then パスワードが更新される
    And 成功メッセージ"パスワードを変更しました"が表示される
    And ログインページ"/login"にリダイレクトされる

  Scenario: パスワードリセットリンクが無効（期限切れ）
    Given パスワードリセットリンクにアクセスしている
    And リンクの有効期限が過ぎている
    When ページが読み込まれる
    Then エラーメッセージ"このリンクは期限切れです"が表示される
    And "新しいリンクを送信"ボタンが表示される

  Scenario: パスワードリセットリンクが無効（既に使用済み）
    Given パスワードリセットリンクにアクセスしている
    And リンクが既に使用されている
    When ページが読み込まれる
    Then エラーメッセージ"このリンクは既に使用されています"が表示される

  Scenario: パスワード変更失敗（パスワード不一致）
    Given パスワードリセットリンクにアクセスしている
    And リンクが有効である
    When 新しいパスワードに"newPassword123"を入力する
    And パスワード確認に"differentPassword"を入力する
    And "パスワードを変更"ボタンをクリックする
    Then エラーメッセージ"パスワードが一致しません"が表示される
    And パスワードは更新されない

  Scenario: パスワード変更失敗（弱いパスワード）
    Given パスワードリセットリンクにアクセスしている
    And リンクが有効である
    When 新しいパスワードに"weak"を入力する
    And パスワード確認に"weak"を入力する
    And "パスワードを変更"ボタンをクリックする
    Then エラーメッセージ"パスワードは8文字以上である必要があります"が表示される
    And パスワードは更新されない

  Scenario: パスワード変更後にログインできる
    Given パスワードリセットリンクにアクセスしている
    And リンクが有効である
    When 新しいパスワードに"newPassword123"を入力する
    And パスワード確認に"newPassword123"を入力する
    And "パスワードを変更"ボタンをクリックする
    Then パスワードが更新される
    And ログインページにリダイレクトされる
    When メールアドレスに"yamada@example.com"を入力する
    And パスワードに"newPassword123"を入力する
    And "ログイン"ボタンをクリックする
    Then ログインが成功する
    And ホームページ"/"にリダイレクトされる

  Scenario: パスワードリセットメールの内容確認
    Given 登録済みユーザー"yamada@example.com"が存在する
    When メールアドレスに"yamada@example.com"を入力する
    And "パスワードリセットメールを送信"ボタンをクリックする
    Then パスワードリセットメールが送信される
    And メールにパスワードリセットリンクが含まれる
    And メールに有効期限が含まれる

  Scenario: ログインページへのリンク確認
    Then "ログインに戻る"リンクが表示される
    And "ログインに戻る"リンクのhrefが"/login"である

