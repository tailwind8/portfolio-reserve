# 買い切り型準備ガイド

**最終更新**: 2026-01-01
**Phase**: Phase 2（買い切り型販売）の準備

---

## 🎯 このガイドの目的

Phase 2（買い切り型販売）を開始するために必要な準備作業をすべてリストアップ。
Phase 1（ポートフォリオ完成）後に、このガイドに沿って準備を進める。

---

## 📋 準備チェックリスト

### 技術面
- [ ] Docker Compose構成の作成
- [ ] セットアップスクリプトの作成
- [ ] バックアップスクリプトの作成
- [ ] .env.example（買い切り版）の作成
- [ ] nginx設定ファイルの作成

### ドキュメント面
- [ ] セットアップガイド（顧客向け）
- [ ] 運用マニュアル
- [ ] FAQ
- [ ] バックアップ・復旧手順書

### 営業面
- [ ] 機能一覧表
- [ ] 料金表
- [ ] デモ動画（3-5分）
- [ ] ヒアリングシート
- [ ] 見積書テンプレート
- [ ] 契約書テンプレート

---

## 🐳 Docker Compose構成

### ファイル配置

```
reserve-system/
└── deployment/
    └── standalone/           # 買い切り版専用
        ├── docker-compose.yml
        ├── nginx.conf
        ├── .env.example
        ├── setup.sh
        ├── backup.sh
        └── README.md
```

### docker-compose.yml

```yaml
version: '3.8'

services:
  # PostgreSQLデータベース
  postgres:
    image: postgres:16-alpine
    container_name: reserve_db
    restart: always
    environment:
      POSTGRES_DB: ${DB_NAME:-reserve_db}
      POSTGRES_USER: ${DB_USER:-postgres}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - pgdata:/var/lib/postgresql/data
      - ./backups:/backups
    ports:
      - "5432:5432"
    networks:
      - reserve_network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Next.jsアプリケーション
  app:
    build:
      context: ../../reserve-app
      dockerfile: Dockerfile
    container_name: reserve_app
    restart: always
    environment:
      DATABASE_URL: postgresql://${DB_USER:-postgres}:${DB_PASSWORD}@postgres:5432/${DB_NAME:-reserve_db}
      NEXT_PUBLIC_TENANT_ID: ${TENANT_ID:-single-customer}
      MULTI_TENANT_MODE: "false"
      NEXT_PUBLIC_SUPABASE_URL: ${SUPABASE_URL}
      NEXT_PUBLIC_SUPABASE_ANON_KEY: ${SUPABASE_ANON_KEY}
      SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY}
      RESEND_API_KEY: ${RESEND_API_KEY}
    depends_on:
      postgres:
        condition: service_healthy
    ports:
      - "3000:3000"
    networks:
      - reserve_network

  # Nginxリバースプロキシ
  nginx:
    image: nginx:alpine
    container_name: reserve_nginx
    restart: always
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./ssl:/etc/nginx/ssl:ro  # SSL証明書（Let's Encrypt）
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - app
    networks:
      - reserve_network

  # バックアップコンテナ（自動バックアップ）
  backup:
    image: prodrigestivill/postgres-backup-local
    container_name: reserve_backup
    restart: always
    environment:
      POSTGRES_HOST: postgres
      POSTGRES_DB: ${DB_NAME:-reserve_db}
      POSTGRES_USER: ${DB_USER:-postgres}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      SCHEDULE: "@daily"  # 毎日バックアップ
      BACKUP_KEEP_DAYS: 14
      BACKUP_KEEP_WEEKS: 4
      BACKUP_KEEP_MONTHS: 6
    volumes:
      - ./backups:/backups
    depends_on:
      - postgres
    networks:
      - reserve_network

volumes:
  pgdata:

networks:
  reserve_network:
    driver: bridge
```

### nginx.conf

```nginx
events {
    worker_connections 1024;
}

http {
    # アップロード制限
    client_max_body_size 10M;

    # タイムアウト設定
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;

    # gzip圧縮
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    upstream app {
        server app:3000;
    }

    # HTTPサーバー（HTTPSへリダイレクト）
    server {
        listen 80;
        server_name _;

        # Let's Encrypt用
        location /.well-known/acme-challenge/ {
            root /var/www/certbot;
        }

        # HTTPSへリダイレクト
        location / {
            return 301 https://$host$request_uri;
        }
    }

    # HTTPSサーバー
    server {
        listen 443 ssl http2;
        server_name _;

        # SSL証明書（Let's Encrypt）
        ssl_certificate /etc/nginx/ssl/fullchain.pem;
        ssl_certificate_key /etc/nginx/ssl/privkey.pem;

        # SSL設定
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers HIGH:!aNULL:!MD5;
        ssl_prefer_server_ciphers on;

        # セキュリティヘッダー
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-XSS-Protection "1; mode=block" always;
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

        location / {
            proxy_pass http://app;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_cache_bypass $http_upgrade;
        }
    }
}
```

### .env.example

```bash
# データベース設定
DB_NAME=reserve_db
DB_USER=postgres
DB_PASSWORD=YOUR_SECURE_PASSWORD_HERE

# テナントID（買い切り版は固定）
TENANT_ID=customer-name

# マルチテナントモード（買い切り版はfalse）
MULTI_TENANT_MODE=false

# Supabase設定
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# メール送信（Resend）
RESEND_API_KEY=re_xxxxxxxxxxxx

# 店舗情報（初期設定）
STORE_NAME=サンプル店舗
STORE_EMAIL=info@example.com
STORE_PHONE=03-1234-5678
```

### setup.sh

```bash
#!/bin/bash
set -e

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  予約管理システム セットアップ"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

# 1. 環境変数チェック
echo ""
echo "[1/7] 環境変数ファイルを確認中..."
if [ ! -f .env ]; then
    echo "❌ .envファイルが見つかりません"
    echo "   .env.exampleをコピーして.envを作成してください"
    echo "   $ cp .env.example .env"
    exit 1
fi
echo "✅ .envファイルが存在します"

# 2. Dockerインストール確認
echo ""
echo "[2/7] Dockerのインストールを確認中..."
if ! command -v docker &> /dev/null; then
    echo "❌ Dockerがインストールされていません"
    echo "   https://docs.docker.com/get-docker/ からインストールしてください"
    exit 1
fi
echo "✅ Docker $(docker --version)"

# 3. Docker Composeインストール確認
echo ""
echo "[3/7] Docker Composeのインストールを確認中..."
if ! command -v docker-compose &> /dev/null; then
    echo "❌ Docker Composeがインストールされていません"
    echo "   https://docs.docker.com/compose/install/ からインストールしてください"
    exit 1
fi
echo "✅ Docker Compose $(docker-compose --version)"

# 4. ポート確認
echo ""
echo "[4/7] ポートの空き状況を確認中..."
if lsof -Pi :80 -sTCP:LISTEN -t >/dev/null 2>&1 ; then
    echo "⚠️  ポート80が使用中です"
    echo "   既存のWebサーバーを停止してください"
    read -p "   続行しますか？ (y/N): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

# 5. Docker Composeでコンテナ起動
echo ""
echo "[5/7] Dockerコンテナを起動中..."
docker-compose up -d
echo "✅ コンテナが起動しました"

# 6. データベース初期化待機
echo ""
echo "[6/7] データベースの準備を待機中..."
sleep 10

# 7. Prismaマイグレーション実行
echo ""
echo "[7/7] データベースマイグレーションを実行中..."
docker-compose exec app npx prisma migrate deploy
docker-compose exec app npx prisma generate
docker-compose exec app npx prisma db seed
echo "✅ マイグレーションが完了しました"

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  🎉 セットアップ完了！"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "次のステップ:"
echo "1. ブラウザで http://localhost にアクセス"
echo "2. 初期管理者でログイン"
echo "   メール: admin@example.com"
echo "   パスワード: admin123"
echo ""
echo "⚠️  セキュリティ: 初期パスワードを必ず変更してください"
echo ""
echo "ログ確認: docker-compose logs -f"
echo "停止: docker-compose down"
echo "再起動: docker-compose restart"
echo ""
```

### backup.sh

```bash
#!/bin/bash
set -e

# バックアップディレクトリ
BACKUP_DIR="./backups/manual"
mkdir -p $BACKUP_DIR

# タイムスタンプ
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/backup_$TIMESTAMP.sql"

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  データベースバックアップ"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "バックアップ開始: $(date)"
echo "保存先: $BACKUP_FILE"
echo ""

# PostgreSQLダンプ
docker-compose exec -T postgres pg_dump -U postgres reserve_db > $BACKUP_FILE

# 圧縮
gzip $BACKUP_FILE

echo "✅ バックアップ完了: ${BACKUP_FILE}.gz"
echo ""

# 古いバックアップを削除（30日以上前）
find $BACKUP_DIR -name "backup_*.sql.gz" -mtime +30 -delete
echo "✅ 30日以上前のバックアップを削除しました"
echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
```

---

## 📄 ドキュメント

### セットアップガイド（顧客向け）

**ファイル**: `documents/handover/セットアップガイド.md`

```markdown
# 予約管理システム セットアップガイド

## 必要なもの

- VPS（推奨: ConoHa VPS 2GB以上）
- ドメイン（例: example.com）
- メールアドレス（Supabase登録用）

## セットアップ手順

### 1. VPSへSSH接続

（省略 - 実際には詳細な手順を記載）

### 2. 必要なソフトウェアのインストール

（省略）

### 3. システムファイルのアップロード

（省略）

### 4. セットアップスクリプトの実行

（省略）
```

### 運用マニュアル

**ファイル**: `documents/handover/運用マニュアル.md`

```markdown
# 予約管理システム 運用マニュアル

## 日常的な操作

### ログイン方法
### スタッフ追加方法
### メニュー追加方法
### 予約確認方法
### 顧客管理方法

## トラブルシューティング

### システムが起動しない場合
### メールが送信されない場合
### ログの確認方法
```

### FAQ

**ファイル**: `documents/handover/FAQ.md`

```markdown
# よくある質問（FAQ）

## Q1. パスワードを忘れました
## Q2. スタッフを削除したい
## Q3. 予約枠の間隔を変更したい
## Q4. バックアップはどうすればいいですか？
## Q5. システムが重いです
```

---

## 💼 営業資料

### 機能一覧表

**ファイル**: `documents/sales/機能一覧表.xlsx`

| 大分類 | 機能名 | 説明 | 基本 | カスタム |
|--------|--------|------|------|---------|
| 予約管理 | 予約登録 | 顧客が24時間予約可能 | ✅ | ✅ |
| 予約管理 | 予約変更 | 予約日時の変更 | ✅ | ✅ |
| 予約管理 | 予約キャンセル | 予約のキャンセル | ✅ | ✅ |
| 予約管理 | カレンダー表示 | 空き状況を視覚的に表示 | ✅ | ✅ |
| 顧客管理 | 顧客一覧 | 全顧客の管理 | ✅ | ✅ |
| 顧客管理 | 顧客メモ | 顧客ごとのメモ記録 | ✅ | ✅ |
| スタッフ管理 | スタッフ登録 | スタッフ情報管理 | ✅ | ✅ |
| スタッフ管理 | シフト設定 | 曜日別シフト設定 | ✅ | ✅ |
| メニュー管理 | メニュー登録 | サービスメニュー管理 | ✅ | ✅ |
| 通知 | 予約確認メール | 自動送信 | ✅ | ✅ |
| 通知 | リマインダーメール | 前日自動送信 | ❌ | ✅ |
| 連携 | LINE連携 | LINE通知 | ❌ | オプション |
| 連携 | Instagram連携 | 投稿連携 | ❌ | オプション |
| 決済 | クレジット決済 | Stripe連携 | ❌ | オプション |

### 料金表

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  予約管理システム 料金表
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【基本パッケージ】          300,000円（税込330,000円）
┗ システム一式（ソースコード含む）
┗ セットアップガイド
┗ 30日間無料サポート
┗ スタッフ・メニュー無制限

【カスタマイズ版】          500,000円〜（税込550,000円〜）
┗ 基本パッケージの内容
┗ ご要望に応じた機能追加・UI変更
┗ 見積もり相談

【オプション】
- セットアップ代行         +50,000円
- デザインカスタマイズ     +100,000円
- LINE連携機能            +50,000円
- Instagram連携機能       +50,000円
- クレジット決済機能       +100,000円
- 複数店舗対応            +150,000円

【保守契約（年額・任意）】
- ベーシック              50,000円/年
  └ バグ修正・セキュリティパッチ提供

- スタンダード            100,000円/年
  └ 上記 + 小規模機能追加（月5時間まで）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【お支払い】
- 着手金: 50%（契約時）
- 残金: 50%（納品時）
- 銀行振込のみ

【納期】
- 基本パッケージ: 1週間
- カスタマイズ版: ご相談（2-4週間）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### ヒアリングシート

**ファイル**: `documents/sales/ヒアリングシート.md`

```markdown
# 顧客ヒアリングシート

**日時**: YYYY/MM/DD
**担当**: XXX
**顧客名**: XXXXX様

## 基本情報

- 業種: [ ] 美容室 [ ] 歯科医院 [ ] 整体院 [ ] 飲食店 [ ] その他（　　　　）
- 店舗名:
- 店舗数: [ ] 1店舗 [ ] 複数店舗（　　店舗）
- スタッフ数: 　　　人
- 月間予約件数（概算）: 　　　件
- 営業時間: 　　時〜　　時
- 定休日:

## 現状の課題

- 現在の予約管理方法: [ ] 電話 [ ] LINE [ ] ホットペッパー [ ] その他（　　　）
- 困っていること:

## 必要な機能

### 必須機能（絶対に必要）
- [ ] 予約登録・変更・キャンセル
- [ ] 顧客管理
- [ ] スタッフ管理
- [ ] メニュー管理
- [ ] その他:

### 欲しい機能（あると嬉しい）
- [ ] LINE連携
- [ ] Instagram連携
- [ ] クレジット決済
- [ ] リマインダーメール
- [ ] 会員ランク機能
- [ ] その他:

### 不要な機能
-

## 技術環境

- ITリテラシー: [ ] 高い [ ] 普通 [ ] 低い
- インフラ希望: [ ] 自社VPS [ ] レンタルサーバー [ ] お任せ
- 予算感: [ ] 30-50万円 [ ] 50-100万円 [ ] 100万円以上

## その他

- 導入希望時期:
- 特記事項:
```

---

## 📊 準備の進め方

### ステップ1: Phase 1完了後すぐ

1. Docker Compose構成を作成
2. セットアップスクリプトを作成
3. VPS版のテスト（ローカルで動作確認）

### ステップ2: 営業資料準備

4. 機能一覧表を作成
5. 料金表を確定
6. デモ動画を撮影（3-5分）

### ステップ3: ドキュメント整備

7. セットアップガイドを作成
8. 運用マニュアルを作成
9. FAQを作成

### ステップ4: 販売開始

10. ココナラに出品
11. SNSで告知
12. 知人・紹介営業開始

---

**Phase 1が完了したら、このガイドに沿って準備を進めましょう！**
