# è¦ç´„å„ªå…ˆé †ä½ã‚¬ã‚¤ãƒ‰

**æœ€çµ‚æ›´æ–°**: 2026-01-06
**å¯¾è±¡**: AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€é–‹ç™ºè€…

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®è¦ç´„ã‚’å„ªå…ˆé †ä½é †ã«æ•´ç†ã—ãŸã‚‚ã®ã§ã™ã€‚

---

## ğŸš¨ å„ªå…ˆåº¦: CRITICALï¼ˆå¿…é ˆï¼‰

ä»¥ä¸‹ã®è¦ç´„ã¯**CIã§è‡ªå‹•ãƒã‚§ãƒƒã‚¯**ã•ã‚Œã€é•åã™ã‚‹ã¨PRãŒãƒãƒ¼ã‚¸ã§ãã¾ã›ã‚“ã€‚

### 1. TypeScriptå‹å®‰å…¨æ€§
- âŒ `any`å‹ã®ä½¿ç”¨ç¦æ­¢
- âœ… `unknown`å‹ + å‹ã‚¬ãƒ¼ãƒ‰ã‚’ä½¿ç”¨

```typescript
// âŒ ç¦æ­¢
const data: any = response;

// âœ… æ¨å¥¨
const data: unknown = response;
if (isValidResponse(data)) { ... }
```

**ãƒã‚§ãƒƒã‚¯**: `npm run lint`, `npm run build:ci`

### 2. ESLintãƒ«ãƒ¼ãƒ«éµå®ˆ
- ã‚¨ãƒ©ãƒ¼0ä»¶ã§ã‚ã‚‹ã“ã¨

**ãƒã‚§ãƒƒã‚¯**: `npm run lint`

### 3. ãƒ†ã‚¹ãƒˆé€šé
- å˜ä½“ãƒ†ã‚¹ãƒˆ: `npm test`
- E2Eã‚¹ãƒ¢ãƒ¼ã‚¯: `npm run test:e2e:smoke`

---

## âš ï¸ å„ªå…ˆåº¦: HIGHï¼ˆå¼·ãæ¨å¥¨ï¼‰

ä»¥ä¸‹ã®è¦ç´„ã¯**CIã§è­¦å‘Š**ã•ã‚Œã¾ã™ã€‚æ—¢å­˜ã‚³ãƒ¼ãƒ‰ä¿®æ­£å¾Œã€å¿…é ˆåŒ–äºˆå®šã€‚

### 4. E2Eãƒ†ã‚¹ãƒˆã§data-testidã‚»ãƒ¬ã‚¯ã‚¿ã‚’ä½¿ç”¨

**ç¾çŠ¶ã®å•é¡Œ**: `getByText`, `:has-text`ãŒå¤šç”¨ã•ã‚Œã¦ã„ã‚‹

```typescript
// âŒ éæ¨å¥¨ï¼ˆãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›´ã§å£Šã‚Œã‚‹ï¼‰
await page.getByText('äºˆç´„ã‚’ç¢ºå®šã™ã‚‹').click();
await page.locator('button:has-text("äºˆç´„")').click();

// âœ… æ¨å¥¨ï¼ˆå®‰å®šã—ãŸã‚»ãƒ¬ã‚¯ã‚¿ï¼‰
await page.locator('[data-testid="submit-booking"]').click();
```

**ãƒã‚§ãƒƒã‚¯**: `.github/workflows/code-standards.yml` ã®test-selector-check

### 5. APIãƒ«ãƒ¼ãƒˆã§Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

**å¯¾è±¡**: POST/PUT/PATCHãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¤APIãƒ«ãƒ¼ãƒˆ

```typescript
// âœ… å¿…é ˆãƒ‘ã‚¿ãƒ¼ãƒ³
import { z } from 'zod';

const schema = z.object({
  name: z.string().min(1),
  email: z.string().email(),
});

export async function POST(request: Request) {
  const body = await request.json();
  const validated = schema.safeParse(body);

  if (!validated.success) {
    return Response.json({ error: validated.error }, { status: 400 });
  }
  // ...
}
```

**ãƒã‚§ãƒƒã‚¯**: `.github/workflows/code-standards.yml` ã®api-validation-check

### 6. tenant_idãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆï¼‰

**å¯¾è±¡**: Prismaã‚¯ã‚¨ãƒªã‚’å«ã‚€å…¨APIãƒ«ãƒ¼ãƒˆ

```typescript
// âŒ å±é™ºï¼ˆä»–ãƒ†ãƒŠãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ãˆã‚‹ï¼‰
const reservations = await prisma.restaurantReservation.findMany();

// âœ… å®‰å…¨
const reservations = await prisma.restaurantReservation.findMany({
  where: {
    tenant_id: TENANT_ID,
    // ...
  },
});
```

**ãƒã‚§ãƒƒã‚¯**: `.github/workflows/code-standards.yml` ã®tenant-filter-check

---

## ğŸ“‹ å„ªå…ˆåº¦: MEDIUMï¼ˆæ¨å¥¨ï¼‰

ä»¥ä¸‹ã®è¦ç´„ã¯**æ‰‹å‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼**ã§ç¢ºèªã•ã‚Œã¾ã™ã€‚

### 7. Page Objectãƒ‘ã‚¿ãƒ¼ãƒ³ä½¿ç”¨

**å¯¾è±¡**: æ–°è¦E2Eãƒ†ã‚¹ãƒˆ

```typescript
// âœ… Page Objectã‚’ä½œæˆ
// src/__tests__/e2e/pages/BookingPage.ts
export class BookingPage {
  constructor(private page: Page) {}

  private selectors = {
    submitButton: '[data-testid="submit-booking"]',
  };

  async submit() {
    await this.page.click(this.selectors.submitButton);
  }
}

// ãƒ†ã‚¹ãƒˆã§ä½¿ç”¨
const bookingPage = new BookingPage(page);
await bookingPage.submit();
```

### 8. Gherkinã‚·ãƒŠãƒªã‚ªå…ˆè¡Œï¼ˆATDD/BDDï¼‰

**å¯¾è±¡**: æ–°æ©Ÿèƒ½é–‹ç™º

**é–‹ç™ºãƒ•ãƒ­ãƒ¼**:
1. Gherkinã‚·ãƒŠãƒªã‚ªä½œæˆï¼ˆ`features/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
2. E2Eãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆRedï¼‰
3. æœ€å°å®Ÿè£…ï¼ˆGreenï¼‰
4. ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

### 9. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«data-testidè¿½åŠ 

**å¯¾è±¡**: button, input, selectç­‰ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–è¦ç´ 

```tsx
<button
  data-testid="submit-booking"
  onClick={handleSubmit}
>
  äºˆç´„ã‚’ç¢ºå®šã™ã‚‹
</button>
```

### 10. ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œ

- ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯HTMLä½¿ç”¨
- aria-labelå±æ€§è¿½åŠ 
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œå¯¾å¿œ

---

## ğŸ“ å„ªå…ˆåº¦: LOWï¼ˆä»»æ„ï¼‰

ä»¥ä¸‹ã¯å“è³ªå‘ä¸Šã®ãŸã‚ã®æ¨å¥¨äº‹é …ã§ã™ã€‚

### 11. ã‚³ãƒ¼ãƒ‰ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆæ—¥æœ¬èªï¼‰

è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã«ã¯æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã€‚

### 12. å˜ä½“ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š

æ–°è¦ã‚³ãƒ¼ãƒ‰ã¯ã‚«ãƒãƒ¬ãƒƒã‚¸80%ã‚’ç›®æ¨™ã«ã€‚

---

## ğŸ“Š ãƒã‚§ãƒƒã‚¯æ–¹æ³•ã¾ã¨ã‚

| å„ªå…ˆåº¦ | ãƒã‚§ãƒƒã‚¯æ–¹æ³• | å¤±æ•—æ™‚ |
|--------|-------------|--------|
| CRITICAL | CIè‡ªå‹•ãƒã‚§ãƒƒã‚¯ | PRãƒãƒ¼ã‚¸ä¸å¯ |
| HIGH | CIè­¦å‘Š | è­¦å‘Šè¡¨ç¤ºï¼ˆå°†æ¥å¿…é ˆåŒ–ï¼‰ |
| MEDIUM | æ‰‹å‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼ | ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§æŒ‡æ‘˜ |
| LOW | ä»»æ„ | æ¨å¥¨ã®ã¿ |

---

## ğŸ”§ è¦ç´„é•åã®ä¿®æ­£æ–¹æ³•

### E2Eãƒ†ã‚¹ãƒˆã‚»ãƒ¬ã‚¯ã‚¿é•åã®ä¿®æ­£

1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«`data-testid`ã‚’è¿½åŠ 
2. Page Objectã®ã‚»ãƒ¬ã‚¯ã‚¿ã‚’æ›´æ–°
3. `getByText`/`:has-text`ã‚’`[data-testid="..."]`ã«ç½®æ›

**å„ªå…ˆä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/__tests__/e2e/pages/MyPage.ts`ï¼ˆ37ä»¶ï¼‰
- `src/__tests__/e2e/pages/LoginPage.ts`ï¼ˆ11ä»¶ï¼‰
- `src/__tests__/e2e/booking-concurrency.spec.ts`ï¼ˆ12ä»¶ï¼‰

### Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 

1. `src/lib/validations.ts`ã«ã‚¹ã‚­ãƒ¼ãƒã‚’è¿½åŠ 
2. APIãƒ«ãƒ¼ãƒˆã§importã—ã¦safeParseã‚’ä½¿ç”¨

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | å†…å®¹ |
|-------------|------|
| `.cursor/rules/é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ãƒ«ãƒ¼ãƒ«.mdc` | ãƒ†ã‚¹ãƒˆãƒ»å®Ÿè£…ã®è©³ç´°ãƒ«ãƒ¼ãƒ« |
| `documents/ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ.md` | PRå‰ãƒã‚§ãƒƒã‚¯é …ç›® |
| `.claude/skills/typescript-security-checker/references/security-checklist.md` | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ç´„ |
| `CLAUDE.md` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚¬ã‚¤ãƒ‰ |

---

**ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã†ã“ã¨ã§ã€CIãƒã‚§ãƒƒã‚¯ã‚’ãƒ‘ã‚¹ã—ã€é«˜å“è³ªãªã‚³ãƒ¼ãƒ‰ã‚’ç¶­æŒã§ãã¾ã™ã€‚**
