# æŠ€è¡“è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

**æœ€çµ‚æ›´æ–°**: 2025-12-31

---

## ç›®æ¬¡

1. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
2. [èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ](#èªè¨¼ã‚·ã‚¹ãƒ†ãƒ )
3. [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
4. [APIè¨­è¨ˆ](#apiè¨­è¨ˆ)
5. [ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ](#ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ)
6. [çŠ¶æ…‹ç®¡ç†](#çŠ¶æ…‹ç®¡ç†)
7. [ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥](#ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥)
8. [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°](#ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°)
9. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–)
10. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–)

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Client (Browser)                      â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          Next.js 16 App Router (React 19)         â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚   Pages    â”‚  â”‚ Components â”‚  â”‚   Lib      â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP/HTTPS
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Next.js API Routes (Backend)                â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  API Routes (Serverless Functions on Vercel)     â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  /api/auth/register                               â”‚  â”‚
â”‚  â”‚  /api/auth/login                                  â”‚  â”‚
â”‚  â”‚  /api/reservations                                â”‚  â”‚
â”‚  â”‚  /api/admin/*                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                          â”‚
                â”‚ Prisma ORM               â”‚ Supabase Auth
                â”‚                          â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  PostgreSQL     â”‚       â”‚  Supabase Auth     â”‚
      â”‚  (Supabase)     â”‚       â”‚  Service           â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è©³ç´°

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

**Next.js 16 (App Router)**
- **React Server Components (RSC)**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **Client Components**: `'use client'`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã§æ˜ç¤º
- **File-based Routing**: `src/app/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ãŒãã®ã¾ã¾ãƒ«ãƒ¼ãƒˆ

**Tailwind CSS 4**
- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ
- ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ï¼ˆç™½ãƒ™ãƒ¼ã‚¹ãƒ»çˆ½ã‚„ã‹ï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆï¼‰

**TypeScript**
- Strict modeæœ‰åŠ¹
- å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã§å‹å®‰å…¨æ€§ã‚’ç¢ºä¿

---

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

**Prisma ORM**
- å‹å®‰å…¨ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†
- Prisma Studioã§ãƒ‡ãƒ¼ã‚¿ç¢ºèª

**Supabase**
- PostgreSQLï¼ˆãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰
- Supabase Authï¼ˆãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ï¼‰
- Connection Poolingï¼ˆPgBouncerï¼‰

**Zod**
- ã‚¹ã‚­ãƒ¼ãƒãƒ™ãƒ¼ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- TypeScriptå‹æ¨è«–
- APIå…¥åŠ›å€¤æ¤œè¨¼

---

## èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 

### Supabase Authçµ±åˆ

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `reserve-app/src/lib/auth.ts`

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ãƒ­ãƒ¼

```typescript
// 1. Supabase Authã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
const { data, error } = await supabase.auth.signUp({
  email: 'user@example.com',
  password: 'password123',
  options: {
    data: {
      name: 'å±±ç”°å¤ªéƒ',
    },
  },
});

// 2. restaurant_usersãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ä¿å­˜
await prisma.restaurantUser.create({
  data: {
    authId: data.user.id, // Supabase Auth UUID
    email: 'user@example.com',
    name: 'å±±ç”°å¤ªéƒ',
    tenantId: 'demo-restaurant',
  },
});
```

---

#### ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼

```typescript
// 1. Supabase Authã§ãƒ­ã‚°ã‚¤ãƒ³
const { data, error } = await supabase.auth.signInWithPassword({
  email: 'user@example.com',
  password: 'password123',
});

// 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã‚’Cookieã«ä¿å­˜
// Next.jsã®Middlewareã§è‡ªå‹•çš„ã«å‡¦ç†
```

---

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

**å®Ÿè£…**: Supabase AuthãŒè‡ªå‹•çš„ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç®¡ç†

**Cookieã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸:**
- `sb-access-token`: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³
- `sb-refresh-token`: ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³

**æœ‰åŠ¹æœŸé™:**
- ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³: 1æ™‚é–“
- ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³: 30æ—¥

---

#### ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ

```typescript
await supabase.auth.signOut();
```

---

### ç®¡ç†è€…æ¨©é™ç®¡ç†

**å®Ÿè£…äºˆå®š**: `restaurant_users.role`ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 

```prisma
model RestaurantUser {
  // ...
  role String @default("customer") // customer | admin | staff
}
```

**æ¨©é™ãƒã‚§ãƒƒã‚¯:**
```typescript
// Middlewareï¼ˆsrc/middleware.tsï¼‰ã§å®Ÿè£…äºˆå®š
export async function middleware(request: NextRequest) {
  const user = await getCurrentUser();

  if (request.nextUrl.pathname.startsWith('/admin')) {
    if (user?.role !== 'admin') {
      return NextResponse.redirect(new URL('/login', request.url));
    }
  }
}
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼äºˆç´„ãƒ•ãƒ­ãƒ¼

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼: äºˆç´„ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
   â†“
2. ãƒ•ãƒ­ãƒ³ãƒˆ: GET /api/menusï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§å–å¾—ï¼‰
   â†“
3. ãƒ•ãƒ­ãƒ³ãƒˆ: GET /api/staffï¼ˆã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§å–å¾—ï¼‰
   â†“
4. ãƒ•ãƒ­ãƒ³ãƒˆ: GET /api/reservations/availability?date=2025-01-20ï¼ˆç©ºãçŠ¶æ³å–å¾—ï¼‰
   â†“
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼: æ—¥æ™‚ãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»ã‚¹ã‚¿ãƒƒãƒ•ã‚’é¸æŠ
   â†“
6. ãƒ•ãƒ­ãƒ³ãƒˆ: POST /api/reservationsï¼ˆäºˆç´„ç™»éŒ²ï¼‰
   â†“
7. ãƒãƒƒã‚¯: Prismaã§äºˆç´„ãƒ‡ãƒ¼ã‚¿ä¿å­˜
   â†“
8. ãƒãƒƒã‚¯: ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆäºˆç´„ç¢ºèªãƒ¡ãƒ¼ãƒ«ï¼‰
   â†“
9. ãƒ•ãƒ­ãƒ³ãƒˆ: äºˆç´„å®Œäº†ç”»é¢è¡¨ç¤º
```

---

### ç®¡ç†è€…äºˆç´„ç®¡ç†ãƒ•ãƒ­ãƒ¼

```
1. ç®¡ç†è€…: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹
   â†“
2. ãƒ•ãƒ­ãƒ³ãƒˆ: GET /api/admin/dashboard/statsï¼ˆçµ±è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—ï¼‰
   â†“
3. ãƒ•ãƒ­ãƒ³ãƒˆ: çµ±è¨ˆã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆæœ¬æ—¥ã®äºˆç´„ä»¶æ•°ã€ä»Šæœˆã®äºˆç´„ä»¶æ•°ï¼‰
   â†“
4. ç®¡ç†è€…: äºˆç´„ä¸€è¦§ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
   â†“
5. ãƒ•ãƒ­ãƒ³ãƒˆ: GET /api/admin/reservationsï¼ˆäºˆç´„ä¸€è¦§å–å¾—ï¼‰
   â†“
6. ãƒ•ãƒ­ãƒ³ãƒˆ: ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºï¼ˆã‚½ãƒ¼ãƒˆãƒ»ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½ï¼‰
   â†“
7. ç®¡ç†è€…: äºˆç´„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å¤‰æ›´
   â†“
8. ãƒ•ãƒ­ãƒ³ãƒˆ: PATCH /api/admin/reservations/:idï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ï¼‰
   â†“
9. ãƒãƒƒã‚¯: Prismaã§ãƒ‡ãƒ¼ã‚¿æ›´æ–°
   â†“
10. ãƒ•ãƒ­ãƒ³ãƒˆ: ä¸€è¦§ã‚’å†å–å¾—ã—ã¦è¡¨ç¤ºæ›´æ–°
```

---

## APIè¨­è¨ˆ

### RESTful APIè¨­è¨ˆåŸå‰‡

**å‘½åè¦å‰‡:**
- ãƒªã‚½ãƒ¼ã‚¹åã¯è¤‡æ•°å½¢ï¼ˆä¾‹: `/api/reservations`ï¼‰
- æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆã‚’å«ã‚€ï¼ˆå¯èª­æ€§å‘ä¸Šï¼‰
- HTTPãƒ¡ã‚½ãƒƒãƒ‰ã§æ“ä½œã‚’è¡¨ç¾ï¼ˆGET, POST, PATCH, DELETEï¼‰

---

### ç¾åœ¨å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹API

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------------|---------|------|----------|
| `/api/auth/register` | POST | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ–°è¦ç™»éŒ² | âœ… |
| `/api/auth/login` | POST | ãƒ­ã‚°ã‚¤ãƒ³ | âœ… |
| `/api/auth/logout` | POST | ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ | ğŸš§ |

---

#### ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------------|---------|------|----------|
| `/api/admin/dashboard/stats` | GET | çµ±è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾— | âœ… |

---

### æœªå®Ÿè£…ã®APIï¼ˆSprint 2-4ã§å®Ÿè£…äºˆå®šï¼‰

#### äºˆç´„æ©Ÿèƒ½

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ | å„ªå…ˆåº¦ |
|--------------|---------|------|--------|
| `/api/menus` | GET | ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§å–å¾— | High |
| `/api/staff` | GET | ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§å–å¾— | High |
| `/api/reservations/availability` | GET | ç©ºãçŠ¶æ³å–å¾— | High |
| `/api/reservations` | GET | äºˆç´„ä¸€è¦§å–å¾—ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰ | High |
| `/api/reservations` | POST | äºˆç´„ç™»éŒ² | High |
| `/api/reservations/:id` | PATCH | äºˆç´„å¤‰æ›´ | Medium |
| `/api/reservations/:id` | DELETE | äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ« | Medium |

---

#### ç®¡ç†è€…æ©Ÿèƒ½

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ | å„ªå…ˆåº¦ |
|--------------|---------|------|--------|
| `/api/admin/reservations` | GET | äºˆç´„ä¸€è¦§å–å¾—ï¼ˆç®¡ç†è€…ï¼‰ | High |
| `/api/admin/reservations` | POST | äºˆç´„æ‰‹å‹•è¿½åŠ  | Medium |
| `/api/admin/reservations/:id` | PATCH | äºˆç´„ç·¨é›† | Medium |
| `/api/admin/reservations/:id` | DELETE | äºˆç´„å‰Šé™¤ | Medium |
| `/api/admin/customers` | GET | é¡§å®¢ä¸€è¦§å–å¾— | Medium |
| `/api/admin/customers/:id` | GET | é¡§å®¢è©³ç´°å–å¾— | Medium |
| `/api/admin/staff` | GET/POST/PATCH/DELETE | ã‚¹ã‚¿ãƒƒãƒ•CRUD | Medium |
| `/api/admin/menus` | GET/POST/PATCH/DELETE | ãƒ¡ãƒ‹ãƒ¥ãƒ¼CRUD | Medium |
| `/api/admin/settings` | GET/PATCH | åº—èˆ—è¨­å®š | Medium |

---

### API ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

**æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```typescript
{
  success: true,
  data: {
    // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿
  },
  message: "å‡¦ç†ãŒæˆåŠŸã—ã¾ã—ãŸ" // ã‚ªãƒ—ã‚·ãƒ§ãƒ³
}
```

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```typescript
{
  success: false,
  error: "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",
  details: {
    // ã‚¨ãƒ©ãƒ¼è©³ç´°ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  }
}
```

**å®Ÿè£…**: `reserve-app/src/lib/api-response.ts`

---

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|--------------|---------|------|----------|
| Header | `src/components/Header.tsx` | ãƒ˜ãƒƒãƒ€ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ | âœ… |
| Footer | `src/components/Footer.tsx` | ãƒ•ãƒƒã‚¿ãƒ¼ | âœ… |
| Button | `src/components/Button.tsx` | æ±ç”¨ãƒœã‚¿ãƒ³ | âœ… |
| Card | `src/components/Card.tsx` | ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠ | âœ… |
| AdminSidebar | `src/components/AdminSidebar.tsx` | ç®¡ç†ç”»é¢ã‚µã‚¤ãƒ‰ãƒãƒ¼ | âœ… |

---

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆåŸå‰‡

**1. Single Responsibility Principleï¼ˆå˜ä¸€è²¬ä»»ã®åŸå‰‡ï¼‰**
- 1ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯1ã¤ã®è²¬å‹™ã®ã¿
- ãƒ­ã‚¸ãƒƒã‚¯ã¨UIã‚’åˆ†é›¢

**2. Composition over Inheritanceï¼ˆç¶™æ‰¿ã‚ˆã‚Šåˆæˆï¼‰**
- `children`propsã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆæˆ
- å†åˆ©ç”¨æ€§ã‚’é«˜ã‚ã‚‹

**3. Props Interfaceå®šç¾©**
- å…¨ã¦ã®Propsã«å‹å®šç¾©
- ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«propsã«ã¯`?`ã‚’ä½¿ç”¨

---

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¾‹

```typescript
// src/components/Button.tsx
interface ButtonProps {
  children: React.ReactNode;
  onClick?: () => void;
  variant?: 'primary' | 'secondary' | 'outline';
  size?: 'sm' | 'md' | 'lg';
  disabled?: boolean;
  type?: 'button' | 'submit' | 'reset';
  'data-testid'?: string;
}

export function Button({
  children,
  onClick,
  variant = 'primary',
  size = 'md',
  disabled = false,
  type = 'button',
  'data-testid': testId,
}: ButtonProps) {
  // å®Ÿè£…...
}
```

---

## çŠ¶æ…‹ç®¡ç†

### ç¾åœ¨ã®çŠ¶æ…‹ç®¡ç†æˆ¦ç•¥

**ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹**: PrismaçµŒç”±ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ï¼ˆServer Componentsï¼‰
**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹**: Reactã®`useState`ã€`useEffect`ã§ç®¡ç†ï¼ˆClient Componentsï¼‰

**å°†æ¥çš„ãªé¸æŠè‚¢ï¼ˆå¿…è¦ã«å¿œã˜ã¦å°å…¥ï¼‰:**
- **React Context**: ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãªã©ï¼‰
- **Zustand**: è»½é‡ãªçŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **TanStack Query**: ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ã®ç®¡ç†ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ãƒªãƒ•ã‚§ãƒƒãƒï¼‰

---

### Server Components vs Client Components

**Server Componentsï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰:**
- ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ã‚’ã‚µãƒ¼ãƒãƒ¼å´ã§å®Ÿè¡Œ
- ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå‰Šæ¸›
- SEOå‘ä¸Š

**Client Componentsï¼ˆ`'use client'`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ï¼‰:**
- `useState`, `useEffect`ãªã©ã®Hooksã‚’ä½¿ç”¨
- ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ï¼ˆonClick, onChangeãªã©ï¼‰
- ãƒ–ãƒ©ã‚¦ã‚¶APIã‚’ä½¿ç”¨

---

## ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥

### Zodã‚¹ã‚­ãƒ¼ãƒ

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `reserve-app/src/lib/validations.ts`

**ä¾‹: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**

```typescript
import { z } from 'zod';

export const registerSchema = z.object({
  name: z.string().min(1, 'åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'),
  email: z.string().email('æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'),
  password: z
    .string()
    .min(8, 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„')
    .max(100, 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„'),
  phone: z.string().optional(),
});

export type RegisterInput = z.infer<typeof registerSchema>;
```

---

### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰:**
```typescript
const result = registerSchema.safeParse(formData);

if (!result.success) {
  // ã‚¨ãƒ©ãƒ¼å‡¦ç†
  console.error(result.error.errors);
  return;
}

// æˆåŠŸã—ãŸå ´åˆã€å‹å®‰å…¨ãªãƒ‡ãƒ¼ã‚¿
const validatedData = result.data;
```

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆAPI Routeï¼‰:**
```typescript
export async function POST(request: Request) {
  const body = await request.json();

  const result = registerSchema.safeParse(body);

  if (!result.success) {
    return apiError('ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼', 400);
  }

  // å‡¦ç†ç¶šè¡Œ...
}
```

---

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### API ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `reserve-app/src/lib/api-response.ts`

**çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```typescript
export function apiError(message: string, status: number = 500) {
  return NextResponse.json(
    {
      success: false,
      error: message,
    },
    { status }
  );
}
```

---

### ã‚¨ãƒ©ãƒ¼ã‚«ãƒ†ã‚´ãƒª

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ | ç”¨é€” | ä¾‹ |
|---------------|------|-----|
| 400 | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ | å…¥åŠ›å€¤ãŒä¸æ­£ |
| 401 | èªè¨¼ã‚¨ãƒ©ãƒ¼ | ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ |
| 403 | æ¨©é™ã‚¨ãƒ©ãƒ¼ | ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ |
| 404 | ãƒªã‚½ãƒ¼ã‚¹æœªç™ºè¦‹ | äºˆç´„ãŒè¦‹ã¤ã‹ã‚‰ãªã„ |
| 409 | ç«¶åˆã‚¨ãƒ©ãƒ¼ | äºˆç´„ãŒé‡è¤‡ã—ã¦ã„ã‚‹ |
| 500 | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼ |

---

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
try {
  const response = await fetch('/api/reservations', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data),
  });

  const result = await response.json();

  if (!result.success) {
    // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºï¼ˆToastã€Alertãªã©ï¼‰
    alert(result.error);
    return;
  }

  // æˆåŠŸå‡¦ç†
} catch (error) {
  console.error('äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼:', error);
  alert('äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
}
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### å®Ÿè£…æ¸ˆã¿ã®æœ€é©åŒ–

**1. Server Componentså„ªå…ˆ**
- ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ã‚’ã‚µãƒ¼ãƒãƒ¼å´ã§å®Ÿè¡Œ
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå‰Šæ¸›

**2. Playwright E2Eãƒ†ã‚¹ãƒˆé«˜é€ŸåŒ–**
- CIç’°å¢ƒ: Chromiumã®ã¿
- ãƒ­ãƒ¼ã‚«ãƒ«: è¤‡æ•°ãƒ–ãƒ©ã‚¦ã‚¶

**3. Prisma Connection Pooling**
- Supabase PgBouncerã‚’ä½¿ç”¨
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã®åŠ¹ç‡åŒ–

---

### ä»Šå¾Œã®æœ€é©åŒ–å€™è£œ

**1. ç”»åƒæœ€é©åŒ–**
- Next.js `<Image>`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½¿ç”¨
- WebPå½¢å¼ã€é…å»¶èª­ã¿è¾¼ã¿

**2. Code Splitting**
- Dynamic Imports
- Route-based Code Splitting

**3. ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥**
- React Server Components Cache
- TanStack Queryï¼ˆå°å…¥æ¤œè¨ï¼‰

**4. Bundle Sizeå‰Šæ¸›**
- Tree Shaking
- ä¸è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å‰Šé™¤

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

### å®Ÿè£…æ¸ˆã¿ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

**1. Supabase Auth**
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–
- ã‚»ã‚­ãƒ¥ã‚¢ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

**2. Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**
- APIå…¥åŠ›å€¤ã®æ¤œè¨¼
- XSSæ”»æ’ƒã®é˜²æ­¢

**3. Prisma ORM**
- SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³é˜²æ­¢
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã•ã‚ŒãŸã‚¯ã‚¨ãƒª

**4. ç’°å¢ƒå¤‰æ•°ç®¡ç†**
- `.env.local`ã‚’Gitç®¡ç†å¤–
- æ©Ÿå¯†æƒ…å ±ã®ä¿è­·

---

### ä»Šå¾Œã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

**1. CSRFå¯¾ç­–**
- ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ã®ä¿è­·

**2. ãƒ¬ãƒ¼ãƒˆåˆ¶é™**
- API Routeã«ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’è¿½åŠ 

**3. ç®¡ç†è€…æ¨©é™ãƒã‚§ãƒƒã‚¯**
- Middlewareã§ç®¡ç†è€…ãƒ«ãƒ¼ãƒˆä¿è­·

**4. ç›£æŸ»ãƒ­ã‚°**
- é‡è¦ãªæ“ä½œã®ãƒ­ã‚°è¨˜éŒ²

---

## ã¾ã¨ã‚

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ä»¥ä¸‹ã®æŠ€è¡“çš„ç‰¹å¾´ã‚’æŒã¡ã¾ã™ï¼š

âœ… **å‹å®‰å…¨æ€§**: TypeScript + Prisma + Zod
âœ… **ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**: Jest + Playwright + ATDD/BDD
âœ… **èªè¨¼**: Supabase Auth
âœ… **CI/CD**: GitHub Actions
âœ… **ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œ**: tenantIdã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿åˆ†é›¢
âœ… **ã‚¹ãƒšãƒƒã‚¯ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆé–‹ç™º**: Gherkinã‚·ãƒŠãƒªã‚ª â†’ E2Eãƒ†ã‚¹ãƒˆ â†’ å®Ÿè£…

è©³ç´°ã¯å„é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

**æœ€çµ‚æ›´æ–°æ—¥**: 2025-12-31
